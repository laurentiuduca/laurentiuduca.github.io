<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<title>../rlsoc-tn/rvsoc_src_ver053/src/microc.v</title>
<link rel="Stylesheet" title="v2html stylesheet" media="Screen" href="v2html.css">
</head>
<script language="JavaScript" type="text/javascript"><!--
var agt=navigator.userAgent.toLowerCase(); 
var is_nav  = ((agt.indexOf('mozilla')!=-1) &&
(agt.indexOf('spoofer')==-1) &&
(agt.indexOf('compatible') == -1) &&
(agt.indexOf('opera')==-1) &&
(agt.indexOf('webtv')==-1)); 
var is_major = parseInt(navigator.appVersion); 
var is_nav4up = (is_nav && (is_major >= 4)); 
var is_ie     = (agt.indexOf("msie") != -1); 
var is_ie4up  = (is_ie  && (is_major >= 4)); 
var is_nav5up = (is_nav && (is_major >= 5));
var dirSep = (window.location.pathname.indexOf('\\') != -1) ? '\\' : '/' ;
function setbuttons (wndw) {
var i;
var sl=wndw.loc[ wndw.document.forms[0].elements[0].selectedIndex ];
for (i=0;i<sl.length;i++) {
if(sl[i]) wndw.document.images[i].src='v2html-b1.gif';
else      wndw.document.images[i].src='v2html-b2.gif';
}
if ( wndw.document.forms[0].elements[0].options[ 
wndw.document.forms[0].elements[0].selectedIndex ].text != '-') {
wndw.document.images[i  ].src='v2html-b1.gif';
wndw.document.images[i+1].src='v2html-b1.gif';
}
else {
wndw.document.images[i  ].src='v2html-b2.gif';
wndw.document.images[i+1].src='v2html-b2.gif';
}
}
// Unindented and uncommented to save spave - look in v2html for a prettier version
var disabled=1;
if (!is_nav4up) {
var event=false; 
}
var last_link=0;     
var last_class=null; 
function qs(e,t,extra_info_index) {
var inc=0,bnum=0,i,j;
if (disabled) return false;
var sig_buttons = [ "Definition" , "Local Driver" , 
"Up to Input Driver" , "Find Source" , "Index"];
if (is_nav4up || is_ie4up) {
if (((e.which==2) && (!(e.modifiers&Event.SHIFT_MASK))) ||
((e.which==1) &&  (e.modifiers&Event.CONTROL_MASK)))   inc = 1;
else if (((e.which==2) && (e.modifiers&Event.SHIFT_MASK)) ||
((e.which==1) && (e.modifiers&Event.SHIFT_MASK))) inc = -1;
if (inc == 0 && extra_info_index == 0) { 
return true;  
}
var linkText = is_nav4up ? t.text : t.innerText;
var linkY    = is_nav4up && ! is_nav5up ? t.y    : t.offsetTop;
window.status="Searching...";
if ((last_link==-1) || (document.links[last_link]!=t)) 
for (last_link=0;last_link<document.links.length;last_link++) 
if (document.links[last_link] == t)  
break;
if (inc != 0) { 
return search(linkText,linkY,last_link,inc,1);
}
else { 
window.status="";
extra_info_index--; 
if (extra_info[extra_info_index][0] != 'S') { 
return true;
}
var w = window.open('','SignalPopUp','width=200,height=235');
if (null != w.document.forms[0]) {
if ((window.location.pathname.substring(0,window.location.pathname.lastIndexOf(dirSep)))!=
(w.pn.substring(0,w.pn.lastIndexOf(dirSep)))) {
w.close();
w = window.open('','SignalPopUp','width=200,height=235');
}
}
w.focus(); 
if (null == w.document.forms[0]) { 
var Text = '<html><head></head>';
if (is_nav4up) { 
w.loc = new Array(10);
w.sel = null;
w.pn  = window.location.pathname;
}
else {     
Text += '<script>var loc = new Array(10);<\/script>\n';
Text += '<script>var sel;<\/script>\n';
Text += '<script>var pn = opener.location.pathname;<\/script>\n';
}
Text += '<body bgcolor="white">\n';
Text += '<form>';
Text += '  <select onchange="opener.setbuttons(window);">\n';
Text += '  <option>---------------------------</option>\n';
for (j=0;j<9;j++) Text += '  <option>-</option>\n';
Text += '  </select>\n';
Text += '</form>';
Text += '<table cellspacing=0 cellpadding=0>\n';
for (var i=0;i<(extra_info[extra_info_index].length-1);i++) {
Text += hbutton(sig_buttons[i], 
'opener.location=loc[sel.selectedIndex]['+i+'];',
bnum++);
}
Text += hbutton("Search Backwards", 
'opener.search(sel.options[ sel.selectedIndex ].text,' +
'0,opener.last_link,-1,0);',bnum++);
Text += hbutton("Search Forwards",
'opener.search(sel.options[ sel.selectedIndex ].text,' +
'0,opener.last_link, 1,0);',bnum++);
Text += hbutton("Close","window.close();",bnum++);
Text += '</table>\n';
Text += '</body></html>\n';
w.document.open();
w.document.write(Text);
w.document.close();
w.document.forms[0].elements[0].options[0].text  = linkText;
w.sel = w.document.forms[0].elements[0]; 
for (j=0;j<10;j++) w.loc[j] = new Array(sig_buttons.length);  
copy_into_loc0(w,extra_info_index);
}
else {
var opts = w.document.forms[0].elements[0].options;
if ( opts.length<10 ) { 
w.loc[opts.length] = new Array;
opts.length++; 
}
for (i=opts.length-2;i>=0;i--) {
opts[i+1].text=opts[i].text;
for (var j=0;j<w.loc[i].length;j++) w.loc[i+1][j] = w.loc[i][j];
}
opts[0].text  = linkText;
copy_into_loc0(w,extra_info_index);
}
return false; 
}
}
return true;
}
function hbutton (text,action,bnum) {
return '  <tr><td><a href="" '+
'onmousedown="'+
'if (images['+bnum+'].src.match(/v2html-b2.gif/)) return false; ' +
'images['+bnum+'].src=\'v2html-b3.gif\';" '+
'onmouseup="'+
'if (images['+bnum+'].src.match(/v2html-b2.gif/)) return false; ' +
'images['+bnum+'].src=\'v2html-b1.gif\';" '+
'onclick="'+
'if (images['+bnum+'].src.match(/v2html-b2.gif/)) return false; ' +
action + 
' return false;">'+
'<img border=0 src="v2html-b1.gif"></a></td>' +
'<td style="font-family:sans-serif; font-weight:bold; font-size:14px;"> '+text+'</td></tr>\n';
}
function copy_into_loc0 (w,extra_info_index) {
for (var i=1;i<extra_info[extra_info_index].length;i++) {
w.loc[0][i-1] = extra_info[extra_info_index][i];
}
w.document.forms[0].elements[0].selectedIndex=1;
w.document.forms[0].elements[0].selectedIndex=0;
setbuttons(w);
}
function search(text,y,i,inc,relative) {
var nextpage,wrappage,linkText,linkY;
window.status="Searching...";
if (last_class) document.links[i].className=last_class;
while (1) {
for (i+=inc;i<document.links.length && i>=0;i+=inc) {
linkText = is_nav4up ? document.links[i].text : document.links[i].innerText;
linkY    = is_nav4up && ! is_nav5up ? document.links[i].y    : document.links[i].offsetTop;
if ((linkText == text) && (linkY != y)) {
window.status="";
if (is_nav4up) 
if (relative) window.scrollBy(0,linkY - y);
else          window.scrollTo(0,linkY); 
else if (is_ie4up)
document.links[i].scrollIntoView(true); 
last_link=i;
last_class=document.links[i].className;
document.links[i].className='HI';
return false;
}
}
nextpage = (inc==1) ? next_page() : prev_page();
wrappage = (inc==1) ? first_page() : last_page();
if (nextpage!="" || wrappage!="") {
if (nextpage=="") { 
if (!confirm(text + " not found. Search again from "+((inc==1)?"first":"last")+" page?"))
return false;
nextpage=wrappage;
}
location=nextpage+ "?" + escape(text) + "&" + ( y - window.pageYOffset ) + "&" + inc;
return false;
}
if (confirm(text + " not found. Search again from "+((inc==1)?"start":"end")+"?")) {
if (inc==1) i=-1;
else i=document.links.length;
} else return false;
}
return true;
}
function loadqs() {
var opt=location.search, text="", s="", y=0, si=0, inc=1;
if (opt.length==0) return true;  
for (var i=1;i<opt.length;i++) { 
if (opt.charAt(i) != "&") 
s += opt.charAt(i);
else {
if (text=="") text=unescape(s);
else             y=s;
s="";
}
}
if (text=="") return true;
if (s == "-1") { si=document.links.length-1; inc=-1; }
window.scrollTo(0,0);
search(text,y,si,inc);
return true;
}
// -->
</script>
<body onload='loadqs();'>
<script language="JavaScript"type="text/javascript"><!--
function prev_page() { return ""; }
function last_page() { return ""; }
// -->
</script>
<center><table class=NB cols=7 ><tr><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy.html';"><a target="_top" href="hierarchy.html">Hierarchy</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-f.html';"><a target="_top" href="hierarchy-f.html">Files</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-m.html';"><a target="_top" href="hierarchy-m.html">Modules</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-s.html';"><a target="_top" href="hierarchy-s.html">Signals</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-t.html';"><a target="_top" href="hierarchy-t.html">Tasks</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-fn.html';"><a target="_top" href="hierarchy-fn.html">Functions</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='http://www.burbleland.com/v2html/help_7_30.html?';"><a target="_top" href="http://www.burbleland.com/v2html/help_7_30.html?">Help</a></td></tr></table></center>
<pre>
<span class=C>/**************************************************************************************************/</span>
<span class=C>/**** Micro Controller for VirtIO ver.2019-11-17a                                              ****/</span>
<span class=C>/**** MicroV (Mikuro Five)                                since 2018-08-07  ArchLab. TokyoTech ****/</span>
<span class=C>/**************************************************************************************************/</span>
<span class=M>`include</span> <a  onClick="return qs(event,this,0)"  class=S href="define.vh.html">&quot;define.vh&quot;</a>

<span class=C>/**************************************************************************************************/</span>
<a name="8"></a><span class=M>`define</span> <a  onClick="return qs(event,this,0)"  class=D href="#8">MC_IF</a>  0     <span class=C>// Inst Fetch
</span><a name="9"></a><span class=M>`define</span> <a  onClick="return qs(event,this,0)"  class=D href="#9">MC_OF</a>  1     <span class=C>// Operand Fetch
</span><a name="10"></a><span class=M>`define</span> <a  onClick="return qs(event,this,0)"  class=D href="#10">MC_EX</a>  2     <span class=C>// Execution
</span><a name="11"></a><span class=M>`define</span> <a  onClick="return qs(event,this,0)"  class=D href="#11">MC_MA</a>  3     <span class=C>// Memory Access
</span>
<span class=C>/**************************************************************************************************/</span>
<a name="14"></a><span class=M>`define</span> <a  onClick="return qs(event,this,0)"  class=D href="#14">D_UC_LM_BITS</a>    13 <span class=C>// 8KB
</span><a name="15"></a><span class=M>`define</span> <a  onClick="return qs(event,this,0)"  class=D href="#15">D_UC_LM_WIDTH</a>   32
<a name="16"></a><span class=M>`define</span> <a  onClick="return qs(event,this,0)"  class=D href="#16">D_UC_LM_IFILE</a>   <span class=S>&quot;ucimage.hex&quot;</span>
<a name="17"></a><span class=M>`define</span> <a  onClick="return qs(event,this,0)"  class=D href="#17">D_UC_LM_SIZE</a>    (1&lt;&lt;(<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="#14">D_UC_LM_BITS</a>)) <span class=C>// do not change
</span>
<span class=C>/**** m_RVuc : Risc-V Micro Controller for VirtIO                                              ****/</span>
<span class=C>/**************************************************************************************************/</span>
<a name="m_RVuc"></a><span class=K>module</span> <span class=MM>m_RVuc</span><a  href="hierarchy-m.html#m_RVuc"><img align=top border=0 alt="Index" src="v2html-i.gif"></a>(<a  onClick="return qs(event,this,1)"  class=SI href="#22">CLK</a>, <a  onClick="return qs(event,this,2)"  class=SI href="#22">RST_X</a>, <a  onClick="return qs(event,this,3)"  class=SI href="#23">w_stall</a>, <a  onClick="return qs(event,this,4)"  class=SO href="#24">w_mic_addr</a>, <a  onClick="return qs(event,this,5)"  class=SI href="#25">w_data</a>, <a  onClick="return qs(event,this,6)"  class=SO href="#26">w_mic_wdata</a>, <a  onClick="return qs(event,this,7)"  class=SO href="#27">w_mic_mmuwe</a>, <a  onClick="return qs(event,this,8)"  class=SO href="#28">w_mic_ctrl</a>, <a  onClick="return qs(event,this,9)"  class=SO href="#29">w_mic_req</a>);
<a name="22"></a>    <span class=K>input</span>  <span class=K>wire</span>         <a  onClick="return qs(event,this,1)"  class=SI href="#22">CLK</a>, <a  onClick="return qs(event,this,2)"  class=SI href="#22">RST_X</a>;
<a name="23"></a>    <span class=K>input</span>  <span class=K>wire</span>         <a  onClick="return qs(event,this,3)"  class=SI href="#23">w_stall</a>;
<a name="24"></a>    <span class=K>output</span> <span class=K>wire</span> [31:0]  <a  onClick="return qs(event,this,4)"  class=SO href="#150">w_mic_addr</a>;
<a name="25"></a>    <span class=K>input</span>  <span class=K>wire</span> [31:0]  <a  onClick="return qs(event,this,5)"  class=SI href="#25">w_data</a>;
<a name="26"></a>    <span class=K>output</span> <span class=K>wire</span> [31:0]  <a  onClick="return qs(event,this,6)"  class=SO href="#151">w_mic_wdata</a>;
<a name="27"></a>    <span class=K>output</span> <span class=K>wire</span>         <a  onClick="return qs(event,this,7)"  class=SO href="#203">w_mic_mmuwe</a>;
<a name="28"></a>    <span class=K>output</span> <span class=K>wire</span>  [2:0]  <a  onClick="return qs(event,this,8)"  class=SO href="#152">w_mic_ctrl</a>;
<a name="29"></a>    <span class=K>output</span> <span class=K>wire</span>  [1:0]  <a  onClick="return qs(event,this,9)"  class=SO href="#61">w_mic_req</a>;

<a name="31"></a>    <span class=K>reg</span>  [31:0] <a  onClick="return qs(event,this,10)"  class=SR href="#208">r_pc</a>     = 0; <span class=C>// program counter (PC)
</span><a name="32"></a>    <span class=K>reg</span>   [1:0] <a  onClick="return qs(event,this,11)"  class=SR href="#46">r_state</a>  = 0; <span class=C>// state, showing the executiong stage
</span><a name="33"></a>    <span class=K>reg</span>  [31:0] <a  onClick="return qs(event,this,12)"  class=SR href="#86">r_ir</a>     = 0; <span class=C>// instruction (IR) to be fetched
</span><a name="34"></a>    <span class=K>reg</span>   [6:0] <a  onClick="return qs(event,this,13)"  class=SR href="#87">r_opcode</a> = 0; <span class=C>// a field of IR
</span><a name="35"></a>    <span class=K>reg</span>   [2:0] <a  onClick="return qs(event,this,14)"  class=SR href="#89">r_funct3</a> = 0; <span class=C>// a field of IR
</span><a name="36"></a>    <span class=K>reg</span>   [6:0] <a  onClick="return qs(event,this,15)"  class=SR href="#90">r_funct7</a> = 0; <span class=C>// a field of IR
</span><a name="37"></a>    <span class=K>reg</span>   [4:0] <a  onClick="return qs(event,this,16)"  class=SR href="#88">r_rd</a>     = 0; <span class=C>// a field of IR
</span><a name="38"></a>    <span class=K>reg</span>  [31:0] <a  onClick="return qs(event,this,17)"  class=SR href="#91">r_imm</a>    = 0; <span class=C>// immediate 
</span><a name="39"></a>    <span class=K>reg</span>  [31:0] <a  onClick="return qs(event,this,18)"  class=SR href="#92">r_rrs1</a>   = 0; <span class=C>// the first  operand
</span><a name="40"></a>    <span class=K>reg</span>  [31:0] <a  onClick="return qs(event,this,19)"  class=SR href="#93">r_rrs2</a>   = 0; <span class=C>// the second operand
</span><a name="41"></a>    <span class=K>reg</span>  [31:0] <a  onClick="return qs(event,this,20)"  class=SR href="#120">r_rslt</a>   = 0; <span class=C>// the execution result
</span>
<a name="43"></a>    <span class=K>reg</span>  [31:0] <a  onClick="return qs(event,this,21)"  class=SR href="#147">r_dram_data</a> = 0;
    
    <span class=K>always</span> @(<span class=K>posedge</span> <a  onClick="return qs(event,this,1)"  class=SI href="#22">CLK</a>) <span class=K>begin</span>
<a name="46"></a>        <a  onClick="return qs(event,this,11)"  class=SR href="#32">r_state</a> &lt;= (!<a  onClick="return qs(event,this,2)"  class=SI href="#22">RST_X</a>) ? 0 : (<a  onClick="return qs(event,this,3)"  class=SI href="#23">w_stall</a>) ? <a  onClick="return qs(event,this,11)"  class=SR href="#46">r_state</a> : (<a  onClick="return qs(event,this,11)"  class=SR href="#46">r_state</a>==<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="#11">MC_MA</a>) ? <span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="#8">MC_IF</a> : <a  onClick="return qs(event,this,11)"  class=SR href="#46">r_state</a>+1;
    <span class=K>end</span>

<a name="49"></a>    <span class=K>wire</span> [31:0] <a  onClick="return qs(event,this,22)"  class=SW href="#204">w_mem_rdata</a>;
<a name="50"></a>    <span class=K>wire</span>        <a  onClick="return qs(event,this,23)"  class=SW href="#50">w_we</a> = (<a  onClick="return qs(event,this,13)"  class=SR href="#87">r_opcode</a>==<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#542">OPCODE_STORE___</a> &amp;&amp; <a  onClick="return qs(event,this,11)"  class=SR href="#46">r_state</a>==<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="#10">MC_EX</a>);

<a name="52"></a>    <span class=K>wire</span> [31:0] <a  onClick="return qs(event,this,24)"  class=SW href="#52">w_reg_d</a>  = (<a  onClick="return qs(event,this,13)"  class=SR href="#87">r_opcode</a>==<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#539">OPCODE_LOAD____</a>) ? <a  onClick="return qs(event,this,22)"  class=SW href="#204">w_mem_rdata</a> : <a  onClick="return qs(event,this,20)"  class=SR href="#120">r_rslt</a>;
<a name="53"></a>    <span class=K>wire</span>        <a  onClick="return qs(event,this,25)"  class=SW href="#53">w_reg_we</a> = (<a  onClick="return qs(event,this,13)"  class=SR href="#87">r_opcode</a>==<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#539">OPCODE_LOAD____</a>) ? 1 :
                           (<a  onClick="return qs(event,this,13)"  class=SR href="#87">r_opcode</a>==<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#545">OPCODE_LUI_____</a>) ? 1 :
                           (<a  onClick="return qs(event,this,13)"  class=SR href="#87">r_opcode</a>==<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#546">OPCODE_AUIPC___</a>) ? 1 :
                           (<a  onClick="return qs(event,this,13)"  class=SR href="#87">r_opcode</a>==<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#547">OPCODE_JAL_____</a>) ? 1 :
                           (<a  onClick="return qs(event,this,13)"  class=SR href="#87">r_opcode</a>==<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#548">OPCODE_JALR____</a>) ? 1 :
                           (<a  onClick="return qs(event,this,13)"  class=SR href="#87">r_opcode</a>==<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#535">OPCODE_OP______</a>) ? 1 :
                           (<a  onClick="return qs(event,this,13)"  class=SR href="#87">r_opcode</a>==<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#538">OPCODE_OP_IMM__</a>) ? 1 : 0;

<a name="61"></a>    <span class=K>assign</span> <a  onClick="return qs(event,this,9)"  class=SO href="#29">w_mic_req</a> = (<a  onClick="return qs(event,this,11)"  class=SR href="#46">r_state</a>==<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="#8">MC_IF</a>)                            ? <span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#344">ACCESS_CODE</a>  :
                   (<a  onClick="return qs(event,this,11)"  class=SR href="#46">r_state</a>==<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="#10">MC_EX</a> &amp;&amp; <a  onClick="return qs(event,this,23)"  class=SW href="#50">w_we</a>)                        ? <span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#343">ACCESS_WRITE</a> :
                   (<a  onClick="return qs(event,this,11)"  class=SR href="#46">r_state</a>==<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="#10">MC_EX</a> &amp;&amp; <a  onClick="return qs(event,this,13)"  class=SR href="#87">r_opcode</a>==<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#539">OPCODE_LOAD____</a>)  ? <span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#342">ACCESS_READ</a>  : 3;

    <span class=C>/******************************************** OF  *********************************************/</span>
<a name="66"></a>    <span class=K>wire</span> [31:0] <a  onClick="return qs(event,this,26)"  class=SW href="#158">w_ir</a>;                       <span class=C>/* 32-bit instruction from memory */</span>
<a name="67"></a>    <span class=K>wire</span>  [6:0] <a  onClick="return qs(event,this,27)"  class=SW href="#67">w_op</a>      = <a  onClick="return qs(event,this,26)"  class=SW href="#158">w_ir</a>[ 6: 0];
<a name="68"></a>    <span class=K>wire</span>  [4:0] <a  onClick="return qs(event,this,28)"  class=SW href="#68">w_rd</a>      = <a  onClick="return qs(event,this,26)"  class=SW href="#158">w_ir</a>[11: 7];
<a name="69"></a>    <span class=K>wire</span>  [4:0] <a  onClick="return qs(event,this,29)"  class=SW href="#69">w_rs1</a>     = <a  onClick="return qs(event,this,26)"  class=SW href="#158">w_ir</a>[19:15];
<a name="70"></a>    <span class=K>wire</span>  [4:0] <a  onClick="return qs(event,this,30)"  class=SW href="#70">w_rs2</a>     = <a  onClick="return qs(event,this,26)"  class=SW href="#158">w_ir</a>[24:20];
<a name="71"></a>    <span class=K>wire</span>  [2:0] <a  onClick="return qs(event,this,31)"  class=SW href="#71">w_funct3</a>  = <a  onClick="return qs(event,this,26)"  class=SW href="#158">w_ir</a>[14:12];
<a name="72"></a>    <span class=K>wire</span>  [6:0] <a  onClick="return qs(event,this,32)"  class=SW href="#72">w_funct7</a>  = <a  onClick="return qs(event,this,26)"  class=SW href="#158">w_ir</a>[31:25];
<a name="73"></a>    <span class=K>wire</span> [11:0] <a  onClick="return qs(event,this,33)"  class=SW href="#73">w_funct12</a> = <a  onClick="return qs(event,this,26)"  class=SW href="#158">w_ir</a>[31:20];
<a name="74"></a>    <span class=K>wire</span> [31:0] <a  onClick="return qs(event,this,34)"  class=SW href="#77">w_imm</a>;
<a name="75"></a>    <span class=K>wire</span> [31:0] <a  onClick="return qs(event,this,35)"  class=SW href="#81">w_rrs1</a>, <a  onClick="return qs(event,this,36)"  class=SW href="#81">w_rrs2</a>;

<a name="m_RVuc_imm_gen0"></a><a name="77"></a>    <a  onClick="return qs(event,this,0)"  class=MM href="rvcorem.v.p2.html#m_imm_gen">m_imm_gen</a> imm_gen0(<a  onClick="return qs(event,this,26)"  class=SW href="#66">w_ir</a>, <a  onClick="return qs(event,this,34)"  class=SW href="#74">w_imm</a>);

<a name="79"></a>    <span class=K>wire</span> <a  onClick="return qs(event,this,37)"  class=SW href="#79">w_reg_w</a> = (<a  onClick="return qs(event,this,25)"  class=SW href="#53">w_reg_we</a> &amp;&amp; <a  onClick="return qs(event,this,11)"  class=SR href="#46">r_state</a>==<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="#8">MC_IF</a> &amp;&amp; !<a  onClick="return qs(event,this,3)"  class=SI href="#23">w_stall</a>); <span class=C>// regfile write_enable
</span>    
<a name="m_RVuc_regs"></a><a name="81"></a>    <a  onClick="return qs(event,this,0)"  class=MM href="rvcorem.v.html#m_regfile">m_regfile</a> regs(<a  onClick="return qs(event,this,1)"  class=SI href="#22">CLK</a>, <a  onClick="return qs(event,this,29)"  class=SW href="#69">w_rs1</a>, <a  onClick="return qs(event,this,30)"  class=SW href="#70">w_rs2</a>, <a  onClick="return qs(event,this,35)"  class=SW href="#75">w_rrs1</a>, <a  onClick="return qs(event,this,36)"  class=SW href="#75">w_rrs2</a>, <a  onClick="return qs(event,this,37)"  class=SW href="#79">w_reg_w</a>, <a  onClick="return qs(event,this,16)"  class=SR href="#37">r_rd</a>, <a  onClick="return qs(event,this,24)"  class=SW href="#52">w_reg_d</a>, 0);

<a name="83"></a>    <span class=K>reg</span>  [31:0] <a  onClick="return qs(event,this,38)"  class=SR href="#94">r_mic_addr</a>  = 0;
    <span class=K>always</span> @(<span class=K>posedge</span> <a  onClick="return qs(event,this,1)"  class=SI href="#22">CLK</a>) <span class=K>begin</span>
        <span class=K>if</span>(<a  onClick="return qs(event,this,11)"  class=SR href="#32">r_state</a> == <span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="#9">MC_OF</a>) <span class=K>begin</span>
<a name="86"></a>            <a  onClick="return qs(event,this,12)"  class=SR href="#33">r_ir</a>     &lt;= <a  onClick="return qs(event,this,26)"  class=SW href="#158">w_ir</a>;
<a name="87"></a>            <a  onClick="return qs(event,this,13)"  class=SR href="#34">r_opcode</a> &lt;= <a  onClick="return qs(event,this,27)"  class=SW href="#67">w_op</a>;
<a name="88"></a>            <a  onClick="return qs(event,this,16)"  class=SR href="#37">r_rd</a>     &lt;= <a  onClick="return qs(event,this,28)"  class=SW href="#68">w_rd</a>;
<a name="89"></a>            <a  onClick="return qs(event,this,14)"  class=SR href="#35">r_funct3</a> &lt;= <a  onClick="return qs(event,this,31)"  class=SW href="#71">w_funct3</a>;
<a name="90"></a>            <a  onClick="return qs(event,this,15)"  class=SR href="#36">r_funct7</a> &lt;= <a  onClick="return qs(event,this,32)"  class=SW href="#72">w_funct7</a>;
<a name="91"></a>            <a  onClick="return qs(event,this,17)"  class=SR href="#38">r_imm</a>    &lt;= <a  onClick="return qs(event,this,34)"  class=SW href="#77">w_imm</a>;
<a name="92"></a>            <a  onClick="return qs(event,this,18)"  class=SR href="#39">r_rrs1</a>   &lt;= <a  onClick="return qs(event,this,35)"  class=SW href="#81">w_rrs1</a>;
<a name="93"></a>            <a  onClick="return qs(event,this,19)"  class=SR href="#40">r_rrs2</a>   &lt;= <a  onClick="return qs(event,this,36)"  class=SW href="#81">w_rrs2</a>;
<a name="94"></a>            <a  onClick="return qs(event,this,38)"  class=SR href="#83">r_mic_addr</a> &lt;= <a  onClick="return qs(event,this,35)"  class=SW href="#81">w_rrs1</a> + <a  onClick="return qs(event,this,34)"  class=SW href="#77">w_imm</a>;
        <span class=K>end</span>
    <span class=K>end</span>

    <span class=C>/******************************************** EX  *********************************************/</span>
<a name="99"></a>    <span class=K>wire</span> [31:0] <a  onClick="return qs(event,this,39)"  class=SW href="#107">w_alu_i_rslt</a>; <span class=C>// integer ALU's result
</span><a name="100"></a>    <span class=K>wire</span>        <a  onClick="return qs(event,this,40)"  class=SW href="#108">w_alu_b_rslt</a>; <span class=C>// branch resolution unit's result
</span>
<a name="102"></a>    <span class=K>wire</span>  [6:0] <a  onClick="return qs(event,this,41)"  class=SW href="#102">w_alu_fn7</a> = (<a  onClick="return qs(event,this,13)"  class=SR href="#87">r_opcode</a>==<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#538">OPCODE_OP_IMM__</a>) ? 
                            ((<a  onClick="return qs(event,this,14)"  class=SR href="#89">r_funct3</a>==<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#564">FUNCT3_ADD___</a>) ? 0 : <a  onClick="return qs(event,this,15)"  class=SR href="#90">r_funct7</a> &amp; 7'h20) : <a  onClick="return qs(event,this,15)"  class=SR href="#90">r_funct7</a>;

<a name="105"></a>    <span class=K>wire</span> [31:0] <a  onClick="return qs(event,this,42)"  class=SW href="#105">w_in2</a> = (<a  onClick="return qs(event,this,13)"  class=SR href="#87">r_opcode</a>==<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#538">OPCODE_OP_IMM__</a>) ? <a  onClick="return qs(event,this,17)"  class=SR href="#91">r_imm</a> : <a  onClick="return qs(event,this,19)"  class=SR href="#93">r_rrs2</a>;
    
<a name="m_RVuc_ALU_I"></a><a name="107"></a>    <a  onClick="return qs(event,this,0)"  class=MM href="rvcorem.v.p2.html#m_alu_i">m_alu_i</a> ALU_I (<a  onClick="return qs(event,this,18)"  class=SR href="#39">r_rrs1</a>, <a  onClick="return qs(event,this,42)"  class=SW href="#105">w_in2</a>, <a  onClick="return qs(event,this,14)"  class=SR href="#35">r_funct3</a>, <a  onClick="return qs(event,this,41)"  class=SW href="#102">w_alu_fn7</a>, <a  onClick="return qs(event,this,39)"  class=SW href="#99">w_alu_i_rslt</a>);
<a name="m_RVuc_ALU_B"></a><a name="108"></a>    <a  onClick="return qs(event,this,0)"  class=MM href="rvcorem.v.p2.html#m_alu_b">m_alu_b</a> ALU_B (<a  onClick="return qs(event,this,18)"  class=SR href="#39">r_rrs1</a>, <a  onClick="return qs(event,this,42)"  class=SW href="#105">w_in2</a>, <a  onClick="return qs(event,this,14)"  class=SR href="#35">r_funct3</a>, <a  onClick="return qs(event,this,40)"  class=SW href="#100">w_alu_b_rslt</a>);

    <span class=C>//wire [31:0] w_jmp_pc   = (r_opcode==`OPCODE_JALR____) ? r_rrs1+r_imm : r_pc+r_imm;
</span>    <span class=C>//wire        w_tkn = (r_opcode==`OPCODE_JAL_____ || r_opcode==`OPCODE_JALR____) ? 1 :
</span>    <span class=C>//                    (r_opcode==`OPCODE_BRANCH__) ? w_alu_b_rslt : 0;
</span>
<a name="114"></a>    <span class=K>reg</span>  [31:0] <a  onClick="return qs(event,this,43)"  class=SR href="#138">r_jmp_pc</a>    = 0;
<a name="115"></a>    <span class=K>reg</span>         <a  onClick="return qs(event,this,44)"  class=SR href="#139">r_tkn</a>       = 0;

    <span class=K>always</span> @(<span class=K>posedge</span> <a  onClick="return qs(event,this,1)"  class=SI href="#22">CLK</a>) <span class=K>begin</span>
        <span class=K>if</span>(<a  onClick="return qs(event,this,11)"  class=SR href="#32">r_state</a> == <span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="#10">MC_EX</a>) <span class=K>begin</span>
           <span class=K>case</span>(<a  onClick="return qs(event,this,13)"  class=SR href="#34">r_opcode</a>)  
<a name="120"></a>               <span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#545">OPCODE_LUI_____</a> : <a  onClick="return qs(event,this,20)"  class=SR href="#41">r_rslt</a> &lt;= <a  onClick="return qs(event,this,17)"  class=SR href="#91">r_imm</a>;
               <span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#546">OPCODE_AUIPC___</a> : <a  onClick="return qs(event,this,20)"  class=SR href="#41">r_rslt</a> &lt;= <a  onClick="return qs(event,this,10)"  class=SR href="#208">r_pc</a> + <a  onClick="return qs(event,this,17)"  class=SR href="#91">r_imm</a>;
               <span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#547">OPCODE_JAL_____</a> : <a  onClick="return qs(event,this,20)"  class=SR href="#41">r_rslt</a> &lt;= <a  onClick="return qs(event,this,10)"  class=SR href="#208">r_pc</a> + 4;
               <span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#548">OPCODE_JALR____</a> : <a  onClick="return qs(event,this,20)"  class=SR href="#41">r_rslt</a> &lt;= <a  onClick="return qs(event,this,10)"  class=SR href="#208">r_pc</a> + 4;
               <span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#535">OPCODE_OP______</a> : <a  onClick="return qs(event,this,20)"  class=SR href="#41">r_rslt</a> &lt;= <a  onClick="return qs(event,this,39)"  class=SW href="#107">w_alu_i_rslt</a>;
               <span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#538">OPCODE_OP_IMM__</a> : <a  onClick="return qs(event,this,20)"  class=SR href="#41">r_rslt</a> &lt;= <a  onClick="return qs(event,this,39)"  class=SW href="#107">w_alu_i_rslt</a>;
               <span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#544">OPCODE_BRANCH__</a> : <a  onClick="return qs(event,this,20)"  class=SR href="#41">r_rslt</a> &lt;= 0;
               <span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#539">OPCODE_LOAD____</a> : <a  onClick="return qs(event,this,20)"  class=SR href="#41">r_rslt</a> &lt;= 0;
               <span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#542">OPCODE_STORE___</a> : <a  onClick="return qs(event,this,20)"  class=SR href="#41">r_rslt</a> &lt;= 0;
               <span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#553">OPCODE_MISC_MEM</a> : <a  onClick="return qs(event,this,20)"  class=SR href="#41">r_rslt</a> &lt;= 0;
               <span class=K>default</span> : <span class=K>begin</span>
                   <a  onClick="return qs(event,this,20)"  class=SR href="#41">r_rslt</a> &lt;= 0;
                   <span class=ST>$write</span>(<span class=S>&quot;UNKNOWN OPCODE DETECT in Micro Controller!!\n&quot;</span>);
                   <span class=ST>$write</span>(<span class=S>&quot;PC:%08x OPCODE=%7b, ir=%8x\n&quot;</span>, <a  onClick="return qs(event,this,10)"  class=SR href="#31">r_pc</a>, <a  onClick="return qs(event,this,13)"  class=SR href="#34">r_opcode</a>, <a  onClick="return qs(event,this,12)"  class=SR href="#33">r_ir</a>);
                   <span class=ST>$write</span>(<span class=S>&quot;Simulation Stopped...\n&quot;</span>);
                   <span class=ST>$finish</span>();
               <span class=K>end</span>
           <span class=K>endcase</span>
<a name="138"></a>            <a  onClick="return qs(event,this,43)"  class=SR href="#114">r_jmp_pc</a> &lt;= (<a  onClick="return qs(event,this,13)"  class=SR href="#87">r_opcode</a>==<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#548">OPCODE_JALR____</a>) ? <a  onClick="return qs(event,this,18)"  class=SR href="#92">r_rrs1</a>+<a  onClick="return qs(event,this,17)"  class=SR href="#91">r_imm</a> : <a  onClick="return qs(event,this,10)"  class=SR href="#208">r_pc</a>+<a  onClick="return qs(event,this,17)"  class=SR href="#91">r_imm</a>;
<a name="139"></a>            <a  onClick="return qs(event,this,44)"  class=SR href="#115">r_tkn</a> &lt;= (<a  onClick="return qs(event,this,13)"  class=SR href="#87">r_opcode</a>==<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#547">OPCODE_JAL_____</a> || <a  onClick="return qs(event,this,13)"  class=SR href="#87">r_opcode</a>==<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#548">OPCODE_JALR____</a>) ? 1 :
                    (<a  onClick="return qs(event,this,13)"  class=SR href="#87">r_opcode</a>==<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#544">OPCODE_BRANCH__</a>) ? <a  onClick="return qs(event,this,40)"  class=SW href="#108">w_alu_b_rslt</a> : 0;
            <span class=C>//r_mic_addr  &lt;= r_rrs1 + r_imm;
</span>        <span class=K>end</span>
    <span class=K>end</span>

    <span class=C>/******************************************** MA  *********************************************/</span>
    <span class=K>always</span>@(<span class=K>posedge</span> <a  onClick="return qs(event,this,1)"  class=SI href="#22">CLK</a>) <span class=K>begin</span>
<a name="147"></a>        <a  onClick="return qs(event,this,21)"  class=SR href="#43">r_dram_data</a> &lt;= <a  onClick="return qs(event,this,5)"  class=SI href="#25">w_data</a>;
    <span class=K>end</span>

<a name="150"></a>    <span class=K>assign</span>  <a  onClick="return qs(event,this,4)"  class=SO href="#24">w_mic_addr</a>  = <a  onClick="return qs(event,this,38)"  class=SR href="#94">r_mic_addr</a>;<span class=C>//r_rrs1 + r_imm;
</span><a name="151"></a>    <span class=K>assign</span>  <a  onClick="return qs(event,this,6)"  class=SO href="#26">w_mic_wdata</a> = <a  onClick="return qs(event,this,19)"  class=SR href="#93">r_rrs2</a>;
<a name="152"></a>    <span class=K>assign</span>  <a  onClick="return qs(event,this,8)"  class=SO href="#28">w_mic_ctrl</a>  = <a  onClick="return qs(event,this,14)"  class=SR href="#89">r_funct3</a>;

<a name="154"></a>    <span class=K>wire</span> [31:0] <a  onClick="return qs(event,this,45)"  class=SW href="#186">w_lcm_data</a>; <span class=C>// data from local memory
</span>    
<a name="156"></a>    <span class=K>wire</span> [31:0] <a  onClick="return qs(event,this,46)"  class=SW href="#156">w_mic_insn_addr</a> = <a  onClick="return qs(event,this,10)"  class=SR href="#208">r_pc</a>;
<a name="157"></a>    <span class=K>wire</span> [31:0] <a  onClick="return qs(event,this,47)"  class=SW href="#176">w_mic_insn_data</a>;
<a name="158"></a>    <span class=K>assign</span>  <a  onClick="return qs(event,this,26)"  class=SW href="#66">w_ir</a> = <a  onClick="return qs(event,this,47)"  class=SW href="#176">w_mic_insn_data</a>;

<a name="160"></a>    <span class=K>reg</span>  [2:0] <a  onClick="return qs(event,this,48)"  class=SR href="#168">r_ctrl</a>  = 3;
<a name="161"></a>    <span class=K>reg</span>  [1:0] <a  onClick="return qs(event,this,49)"  class=SR href="#167">r_addr2</a> = 0;

<a name="163"></a>    <span class=K>wire</span> [31:0] <a  onClick="return qs(event,this,50)"  class=SW href="#172">w_wdata_t</a>, <a  onClick="return qs(event,this,51)"  class=SW href="#200">w_odata1</a>, <a  onClick="return qs(event,this,52)"  class=SW href="#201">w_odata2</a>;


    <span class=K>always</span>@(<span class=K>posedge</span> <a  onClick="return qs(event,this,1)"  class=SI href="#22">CLK</a>) <span class=K>begin</span>
<a name="167"></a>        <a  onClick="return qs(event,this,49)"  class=SR href="#161">r_addr2</a> &lt;= <a  onClick="return qs(event,this,4)"  class=SO href="#150">w_mic_addr</a>;
<a name="168"></a>        <a  onClick="return qs(event,this,48)"  class=SR href="#160">r_ctrl</a>  &lt;= <a  onClick="return qs(event,this,8)"  class=SO href="#152">w_mic_ctrl</a>;
    <span class=K>end</span>

    <span class=C>// Select Output DATA
</span><a name="172"></a>    <span class=K>assign</span> <a  onClick="return qs(event,this,50)"  class=SW href="#163">w_wdata_t</a> =  (<a  onClick="return qs(event,this,8)"  class=SO href="#152">w_mic_ctrl</a>[1:0]==0) ? {4{<a  onClick="return qs(event,this,6)"  class=SO href="#151">w_mic_wdata</a>[7:0]}} :
                        (<a  onClick="return qs(event,this,8)"  class=SO href="#152">w_mic_ctrl</a>[1:0]==1) ? {2{<a  onClick="return qs(event,this,6)"  class=SO href="#151">w_mic_wdata</a>[15:0]}} :
                        <a  onClick="return qs(event,this,6)"  class=SO href="#151">w_mic_wdata</a>;

<a name="176"></a>    <span class=K>assign</span> <a  onClick="return qs(event,this,47)"  class=SW href="#157">w_mic_insn_data</a>  = <a  onClick="return qs(event,this,51)"  class=SW href="#200">w_odata1</a>;
    
<a name="178"></a>    <span class=K>wire</span> [31:0] <a  onClick="return qs(event,this,53)"  class=SW href="#178">w_odata2_t</a>  = <a  onClick="return qs(event,this,52)"  class=SW href="#201">w_odata2</a>;
<a name="179"></a>    <span class=K>wire</span> [31:0] <a  onClick="return qs(event,this,54)"  class=SW href="#179">w_odata2_t2</a> = <a  onClick="return qs(event,this,53)"  class=SW href="#178">w_odata2_t</a> &gt;&gt; {<a  onClick="return qs(event,this,49)"  class=SR href="#167">r_addr2</a>[1:0], 3'b0};

<a name="181"></a>    <span class=K>wire</span> [31:0] <a  onClick="return qs(event,this,55)"  class=SW href="#181">w_odata2_lb</a>  = {{24{<a  onClick="return qs(event,this,54)"  class=SW href="#179">w_odata2_t2</a>[7]}}, <a  onClick="return qs(event,this,54)"  class=SW href="#179">w_odata2_t2</a>[7:0]};
<a name="182"></a>    <span class=K>wire</span> [31:0] <a  onClick="return qs(event,this,56)"  class=SW href="#182">w_odata2_lbu</a> = {24'h0, <a  onClick="return qs(event,this,54)"  class=SW href="#179">w_odata2_t2</a>[7:0]};
<a name="183"></a>    <span class=K>wire</span> [31:0] <a  onClick="return qs(event,this,57)"  class=SW href="#183">w_odata2_lh</a>  = {{16{<a  onClick="return qs(event,this,54)"  class=SW href="#179">w_odata2_t2</a>[15]}}, <a  onClick="return qs(event,this,54)"  class=SW href="#179">w_odata2_t2</a>[15:0]};
<a name="184"></a>    <span class=K>wire</span> [31:0] <a  onClick="return qs(event,this,58)"  class=SW href="#184">w_odata2_lhu</a> = {16'h0, <a  onClick="return qs(event,this,54)"  class=SW href="#179">w_odata2_t2</a>[15:0]};
    
<a name="186"></a>    <span class=K>assign</span> <a  onClick="return qs(event,this,45)"  class=SW href="#154">w_lcm_data</a> = (<a  onClick="return qs(event,this,48)"  class=SR href="#168">r_ctrl</a>[1:0]==3'b000) ? <a  onClick="return qs(event,this,55)"  class=SW href="#181">w_odata2_lb</a> :
                        (<a  onClick="return qs(event,this,48)"  class=SR href="#168">r_ctrl</a>[1:0]==3'b100) ? <a  onClick="return qs(event,this,56)"  class=SW href="#182">w_odata2_lbu</a>:
                        (<a  onClick="return qs(event,this,48)"  class=SR href="#168">r_ctrl</a>[1:0]==3'b001) ? <a  onClick="return qs(event,this,57)"  class=SW href="#183">w_odata2_lh</a> :
                        (<a  onClick="return qs(event,this,48)"  class=SR href="#168">r_ctrl</a>[1:0]==3'b101) ? <a  onClick="return qs(event,this,58)"  class=SW href="#184">w_odata2_lhu</a>: <a  onClick="return qs(event,this,54)"  class=SW href="#179">w_odata2_t2</a>;

    <span class=C>// Check Write Enable
</span><a name="192"></a>    <span class=K>wire</span>  [3:0] <a  onClick="return qs(event,this,59)"  class=SW href="#192">w_we_sb</a> = (4'b0001 &lt;&lt; <a  onClick="return qs(event,this,4)"  class=SO href="#150">w_mic_addr</a>[1:0]);
<a name="193"></a>    <span class=K>wire</span>  [3:0] <a  onClick="return qs(event,this,60)"  class=SW href="#193">w_we_sh</a> = (4'b0011 &lt;&lt; {<a  onClick="return qs(event,this,4)"  class=SO href="#150">w_mic_addr</a>[1], 1'b0});
<a name="194"></a>    <span class=K>wire</span>  [3:0] <a  onClick="return qs(event,this,61)"  class=SW href="#194">w_we_sw</a> = 4'b1111;
<a name="195"></a>    <span class=K>wire</span>  [3:0] <a  onClick="return qs(event,this,62)"  class=SW href="#195">w_mic_lcmwe</a> =   (!(<a  onClick="return qs(event,this,23)"  class=SW href="#50">w_we</a> &amp;&amp; <a  onClick="return qs(event,this,4)"  class=SO href="#150">w_mic_addr</a>[31:28]==0 &amp;&amp; !<a  onClick="return qs(event,this,3)"  class=SI href="#23">w_stall</a>))   ? 0 :
                                (<a  onClick="return qs(event,this,8)"  class=SO href="#152">w_mic_ctrl</a>[1:0]==2)                            ? <a  onClick="return qs(event,this,61)"  class=SW href="#194">w_we_sw</a> :
                                (<a  onClick="return qs(event,this,8)"  class=SO href="#152">w_mic_ctrl</a>[1:0]==1)                            ? <a  onClick="return qs(event,this,60)"  class=SW href="#193">w_we_sh</a> : <a  onClick="return qs(event,this,59)"  class=SW href="#192">w_we_sb</a>;

    <span class=C>// BRAMs
</span><a name="m_RVuc_lm_mc"></a><a name="200"></a>    <a  onClick="return qs(event,this,0)"  class=MM href="#m_lm_mc">m_lm_mc</a> lm_mc(<a  onClick="return qs(event,this,1)"  class=SI href="#22">CLK</a>, <a  onClick="return qs(event,this,46)"  class=SW href="#156">w_mic_insn_addr</a>[<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="#14">D_UC_LM_BITS</a>-1:2], <a  onClick="return qs(event,this,51)"  class=SW href="#163">w_odata1</a>,
<a name="201"></a>                    <a  onClick="return qs(event,this,62)"  class=SW href="#195">w_mic_lcmwe</a>, <a  onClick="return qs(event,this,4)"  class=SO href="#24">w_mic_addr</a>[<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="#14">D_UC_LM_BITS</a>-1:2], <a  onClick="return qs(event,this,52)"  class=SW href="#163">w_odata2</a>, <a  onClick="return qs(event,this,50)"  class=SW href="#163">w_wdata_t</a>);
    
<a name="203"></a>    <span class=K>assign</span> <a  onClick="return qs(event,this,7)"  class=SO href="#27">w_mic_mmuwe</a>  = <a  onClick="return qs(event,this,23)"  class=SW href="#50">w_we</a> &amp;&amp; (<a  onClick="return qs(event,this,4)"  class=SO href="#150">w_mic_addr</a>[31:28]!=0);
<a name="204"></a>    <span class=K>assign</span> <a  onClick="return qs(event,this,22)"  class=SW href="#49">w_mem_rdata</a>  = (<a  onClick="return qs(event,this,4)"  class=SO href="#150">w_mic_addr</a>[31:28]==0) ? <a  onClick="return qs(event,this,45)"  class=SW href="#186">w_lcm_data</a> : <a  onClick="return qs(event,this,21)"  class=SR href="#147">r_dram_data</a>;

    <span class=C>/**********************************************************************************************/</span>
    <span class=K>always</span> @(<span class=K>posedge</span> <a  onClick="return qs(event,this,1)"  class=SI href="#22">CLK</a>) <span class=K>begin</span> <span class=C>/***** update program counter */</span>
<a name="208"></a>        <a  onClick="return qs(event,this,10)"  class=SR href="#31">r_pc</a> &lt;= (!<a  onClick="return qs(event,this,2)"  class=SI href="#22">RST_X</a>) ? 0 : (<a  onClick="return qs(event,this,11)"  class=SR href="#46">r_state</a>!=<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="#11">MC_MA</a> || <a  onClick="return qs(event,this,3)"  class=SI href="#23">w_stall</a>) ? <a  onClick="return qs(event,this,10)"  class=SR href="#208">r_pc</a> : (<a  onClick="return qs(event,this,44)"  class=SR href="#139">r_tkn</a>) ? <a  onClick="return qs(event,this,43)"  class=SR href="#138">r_jmp_pc</a> : <a  onClick="return qs(event,this,10)"  class=SR href="#208">r_pc</a>+4;
    <span class=K>end</span>
<span class=K>endmodule</span>
<span class=C>/**************************************************************************************************/</span>

<span class=C>/*** Local Memory for Micro Controller                                                          ***/</span>
<span class=C>/**************************************************************************************************/</span>
<a name="m_lm_mc"></a><a  href="microc.v.html#m_RVuc_lm_mc"><img alt="[Up: m_RVuc lm_mc]" align=bottom border=0 src="v2html-up.gif"></a>
<span class=K>module</span> <span class=MM>m_lm_mc</span><a  href="hierarchy-m.html#m_lm_mc"><img align=top border=0 alt="Index" src="v2html-i.gif"></a>(<a  onClick="return qs(event,this,63)"  class=SI href="#216">CLK</a>, <a  onClick="return qs(event,this,64)"  class=SI href="#218">w_addr1</a>, <a  onClick="return qs(event,this,65)"  class=SOR href="#220">r_odata1</a>, <a  onClick="return qs(event,this,66)"  class=SI href="#217">w_we</a>, <a  onClick="return qs(event,this,67)"  class=SI href="#218">w_addr2</a>, <a  onClick="return qs(event,this,68)"  class=SOR href="#220">r_odata2</a>, <a  onClick="return qs(event,this,69)"  class=SI href="#219">w_idata</a>);
<a name="216"></a>    <span class=K>input</span>  <span class=K>wire</span>                         <a  onClick="return qs(event,this,63)"  class=SI href="#200">CLK</a>;
<a name="217"></a>    <span class=K>input</span>  <span class=K>wire</span>                   [3:0] <a  onClick="return qs(event,this,66)"  class=SI href="#201">w_we</a>;
<a name="218"></a>    <span class=K>input</span>  <span class=K>wire</span> [(<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="#14">D_UC_LM_BITS</a>-2)-1:0] <a  onClick="return qs(event,this,64)"  class=SI href="#200">w_addr1</a>, <a  onClick="return qs(event,this,67)"  class=SI href="#201">w_addr2</a>;
<a name="219"></a>    <span class=K>input</span>  <span class=K>wire</span>    [<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="#15">D_UC_LM_WIDTH</a>-1:0] <a  onClick="return qs(event,this,69)"  class=SI href="#201">w_idata</a>;
<a name="220"></a>    <span class=K>output</span>  <span class=K>reg</span>    [<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="#15">D_UC_LM_WIDTH</a>-1:0] <a  onClick="return qs(event,this,65)"  class=SOR href="#229">r_odata1</a>, <a  onClick="return qs(event,this,68)"  class=SOR href="#236">r_odata2</a>;

<a name="222"></a>    <span class=AT>(* ram_style = &quot;block&quot; *)</span> <span class=K>reg</span> [<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="#15">D_UC_LM_WIDTH</a>-1:0] <a  onClick="return qs(event,this,70)"  class=SR href="#232">mem</a>[0:(<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="#17">D_UC_LM_SIZE</a>/4)-1];
    <span class=K>initial</span> <span class=K>begin</span>
        <span class=ST>$readmemh</span>(<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="#16">D_UC_LM_IFILE</a>, <a  onClick="return qs(event,this,70)"  class=SR href="#222">mem</a>);
        <span class=ST>$write</span>(<span class=S>&quot;Load a micro contoroller's program: %s\n&quot;</span>, <span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="#16">D_UC_LM_IFILE</a>);
    <span class=K>end</span>

    <span class=K>always</span>@(<span class=K>posedge</span> <a  onClick="return qs(event,this,63)"  class=SI href="#216">CLK</a>) <span class=K>begin</span>
<a name="229"></a>        <a  onClick="return qs(event,this,65)"  class=SOR href="#220">r_odata1</a> &lt;= <a  onClick="return qs(event,this,70)"  class=SR href="#232">mem</a>[<a  onClick="return qs(event,this,64)"  class=SI href="#218">w_addr1</a>];
    <span class=K>end</span>
    <span class=K>always</span> @(<span class=K>posedge</span> <a  onClick="return qs(event,this,63)"  class=SI href="#216">CLK</a>) <span class=K>begin</span>
<a name="232"></a>        <span class=K>if</span> (<a  onClick="return qs(event,this,66)"  class=SI href="#217">w_we</a>[0]) <a  onClick="return qs(event,this,70)"  class=SR href="#222">mem</a>[<a  onClick="return qs(event,this,67)"  class=SI href="#218">w_addr2</a>][ 7: 0] &lt;= <a  onClick="return qs(event,this,69)"  class=SI href="#219">w_idata</a>[ 7: 0];
        <span class=K>if</span> (<a  onClick="return qs(event,this,66)"  class=SI href="#217">w_we</a>[1]) <a  onClick="return qs(event,this,70)"  class=SR href="#222">mem</a>[<a  onClick="return qs(event,this,67)"  class=SI href="#218">w_addr2</a>][15: 8] &lt;= <a  onClick="return qs(event,this,69)"  class=SI href="#219">w_idata</a>[15: 8];
        <span class=K>if</span> (<a  onClick="return qs(event,this,66)"  class=SI href="#217">w_we</a>[2]) <a  onClick="return qs(event,this,70)"  class=SR href="#222">mem</a>[<a  onClick="return qs(event,this,67)"  class=SI href="#218">w_addr2</a>][23:16] &lt;= <a  onClick="return qs(event,this,69)"  class=SI href="#219">w_idata</a>[23:16];
        <span class=K>if</span> (<a  onClick="return qs(event,this,66)"  class=SI href="#217">w_we</a>[3]) <a  onClick="return qs(event,this,70)"  class=SR href="#222">mem</a>[<a  onClick="return qs(event,this,67)"  class=SI href="#218">w_addr2</a>][31:24] &lt;= <a  onClick="return qs(event,this,69)"  class=SI href="#219">w_idata</a>[31:24];
<a name="236"></a>        <a  onClick="return qs(event,this,68)"  class=SOR href="#220">r_odata2</a> &lt;= <a  onClick="return qs(event,this,70)"  class=SR href="#232">mem</a>[<a  onClick="return qs(event,this,67)"  class=SI href="#218">w_addr2</a>];
    <span class=K>end</span>
<span class=K>endmodule</span>
<span class=C>/**************************************************************************************************/</span>

</pre>
<center><table class=NB cols=7 ><tr><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy.html';"><a target="_top" href="hierarchy.html">Hierarchy</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-f.html';"><a target="_top" href="hierarchy-f.html">Files</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-m.html';"><a target="_top" href="hierarchy-m.html">Modules</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-s.html';"><a target="_top" href="hierarchy-s.html">Signals</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-t.html';"><a target="_top" href="hierarchy-t.html">Tasks</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-fn.html';"><a target="_top" href="hierarchy-fn.html">Functions</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='http://www.burbleland.com/v2html/help_7_30.html?';"><a target="_top" href="http://www.burbleland.com/v2html/help_7_30.html?">Help</a></td></tr></table></center>
<script language="JavaScript"type="text/javascript"><!--
function next_page() { return ""; }
function first_page() { return ""; }
var extra_info = [
["S","microc.v.html#22","","","microc.v.html#22","hierarchy-s.p2.html#CLK___m_RVuc"],
["S","microc.v.html#22","","","microc.v.html#22","hierarchy-s.p7.html#RST_X___m_RVuc"],
["S","microc.v.html#23","","","microc.v.html#23","hierarchy-s.p10.html#w_stall___m_RVuc"],
["S","microc.v.html#24","microc.v.html#150","","microc.v.html#150","hierarchy-s.p10.html#w_mic_addr___m_RVuc"],
["S","microc.v.html#25","","","microc.v.html#25","hierarchy-s.p10.html#w_data___m_RVuc"],
["S","microc.v.html#26","microc.v.html#151","","microc.v.html#151","hierarchy-s.p10.html#w_mic_wdata___m_RVuc"],
["S","microc.v.html#27","microc.v.html#203","","microc.v.html#203","hierarchy-s.p10.html#w_mic_mmuwe___m_RVuc"],
["S","microc.v.html#28","microc.v.html#152","","microc.v.html#152","hierarchy-s.p10.html#w_mic_ctrl___m_RVuc"],
["S","microc.v.html#29","microc.v.html#61","","microc.v.html#61","hierarchy-s.p10.html#w_mic_req___m_RVuc"],
["S","microc.v.html#31","microc.v.html#208","","microc.v.html#208","hierarchy-s.p7.html#r_pc___m_RVuc"],
["S","microc.v.html#32","microc.v.html#46","","microc.v.html#46","hierarchy-s.p7.html#r_state___m_RVuc"],
["S","microc.v.html#33","microc.v.html#86","","microc.v.html#86","hierarchy-s.p7.html#r_ir___m_RVuc"],
["S","microc.v.html#34","microc.v.html#87","","microc.v.html#87","hierarchy-s.p7.html#r_opcode___m_RVuc"],
["S","microc.v.html#35","microc.v.html#89","","microc.v.html#89","hierarchy-s.p7.html#r_funct3___m_RVuc"],
["S","microc.v.html#36","microc.v.html#90","","microc.v.html#90","hierarchy-s.p7.html#r_funct7___m_RVuc"],
["S","microc.v.html#37","microc.v.html#88","","microc.v.html#88","hierarchy-s.p7.html#r_rd___m_RVuc"],
["S","microc.v.html#38","microc.v.html#91","","microc.v.html#91","hierarchy-s.p7.html#r_imm___m_RVuc"],
["S","microc.v.html#39","microc.v.html#92","","microc.v.html#92","hierarchy-s.p7.html#r_rrs1___m_RVuc"],
["S","microc.v.html#40","microc.v.html#93","","microc.v.html#93","hierarchy-s.p7.html#r_rrs2___m_RVuc"],
["S","microc.v.html#41","microc.v.html#120","","microc.v.html#120","hierarchy-s.p7.html#r_rslt___m_RVuc"],
["S","microc.v.html#43","microc.v.html#147","","microc.v.html#147","hierarchy-s.p7.html#r_dram_data___m_RVuc"],
["S","microc.v.html#49","microc.v.html#204","","microc.v.html#204","hierarchy-s.p10.html#w_mem_rdata___m_RVuc"],
["S","microc.v.html#50","microc.v.html#50","","microc.v.html#50","hierarchy-s.p10.html#w_we___m_RVuc"],
["S","microc.v.html#52","microc.v.html#52","","microc.v.html#52","hierarchy-s.p10.html#w_reg_d___m_RVuc"],
["S","microc.v.html#53","microc.v.html#53","","microc.v.html#53","hierarchy-s.p10.html#w_reg_we___m_RVuc"],
["S","microc.v.html#66","microc.v.html#158","","microc.v.html#158","hierarchy-s.p10.html#w_ir___m_RVuc"],
["S","microc.v.html#67","microc.v.html#67","","microc.v.html#67","hierarchy-s.p10.html#w_op___m_RVuc"],
["S","microc.v.html#68","microc.v.html#68","","microc.v.html#68","hierarchy-s.p10.html#w_rd___m_RVuc"],
["S","microc.v.html#69","microc.v.html#69","","microc.v.html#69","hierarchy-s.p10.html#w_rs1___m_RVuc"],
["S","microc.v.html#70","microc.v.html#70","","microc.v.html#70","hierarchy-s.p10.html#w_rs2___m_RVuc"],
["S","microc.v.html#71","microc.v.html#71","","microc.v.html#71","hierarchy-s.p10.html#w_funct3___m_RVuc"],
["S","microc.v.html#72","microc.v.html#72","","microc.v.html#72","hierarchy-s.p10.html#w_funct7___m_RVuc"],
["S","microc.v.html#73","microc.v.html#73","","microc.v.html#73","hierarchy-s.p10.html#w_funct12___m_RVuc"],
["S","microc.v.html#74","microc.v.html#77","","rvcorem.v.p2.html#1205","hierarchy-s.p10.html#w_imm___m_RVuc"],
["S","microc.v.html#75","microc.v.html#81","","rvcorem.v.html#33","hierarchy-s.p10.html#w_rrs1___m_RVuc"],
["S","microc.v.html#75","microc.v.html#81","","rvcorem.v.html#34","hierarchy-s.p10.html#w_rrs2___m_RVuc"],
["S","microc.v.html#79","microc.v.html#79","","microc.v.html#79","hierarchy-s.p10.html#w_reg_w___m_RVuc"],
["S","microc.v.html#83","microc.v.html#94","","microc.v.html#94","hierarchy-s.p7.html#r_mic_addr___m_RVuc"],
["S","microc.v.html#99","microc.v.html#107","","rvcorem.v.p2.html#1235","hierarchy-s.p10.html#w_alu_i_rslt___m_RVuc"],
["S","microc.v.html#100","microc.v.html#108","","rvcorem.v.p2.html#1130","hierarchy-s.p10.html#w_alu_b_rslt___m_RVuc"],
["S","microc.v.html#102","microc.v.html#102","","microc.v.html#102","hierarchy-s.p10.html#w_alu_fn7___m_RVuc"],
["S","microc.v.html#105","microc.v.html#105","","microc.v.html#105","hierarchy-s.p10.html#w_in2___m_RVuc"],
["S","microc.v.html#114","microc.v.html#138","","microc.v.html#138","hierarchy-s.p7.html#r_jmp_pc___m_RVuc"],
["S","microc.v.html#115","microc.v.html#139","","microc.v.html#139","hierarchy-s.p7.html#r_tkn___m_RVuc"],
["S","microc.v.html#154","microc.v.html#186","","microc.v.html#186","hierarchy-s.p10.html#w_lcm_data___m_RVuc"],
["S","microc.v.html#156","microc.v.html#156","","microc.v.html#156","hierarchy-s.p10.html#w_mic_insn_addr___m_RVuc"],
["S","microc.v.html#157","microc.v.html#176","","microc.v.html#176","hierarchy-s.p10.html#w_mic_insn_data___m_RVuc"],
["S","microc.v.html#160","microc.v.html#168","","microc.v.html#168","hierarchy-s.p7.html#r_ctrl___m_RVuc"],
["S","microc.v.html#161","microc.v.html#167","","microc.v.html#167","hierarchy-s.p7.html#r_addr2___m_RVuc"],
["S","microc.v.html#163","microc.v.html#172","","microc.v.html#172","hierarchy-s.p10.html#w_wdata_t___m_RVuc"],
["S","microc.v.html#163","microc.v.html#200","","microc.v.html#229","hierarchy-s.p10.html#w_odata1___m_RVuc"],
["S","microc.v.html#163","microc.v.html#201","","microc.v.html#236","hierarchy-s.p10.html#w_odata2___m_RVuc"],
["S","microc.v.html#178","microc.v.html#178","","microc.v.html#178","hierarchy-s.p10.html#w_odata2_t___m_RVuc"],
["S","microc.v.html#179","microc.v.html#179","","microc.v.html#179","hierarchy-s.p10.html#w_odata2_t2___m_RVuc"],
["S","microc.v.html#181","microc.v.html#181","","microc.v.html#181","hierarchy-s.p10.html#w_odata2_lb___m_RVuc"],
["S","microc.v.html#182","microc.v.html#182","","microc.v.html#182","hierarchy-s.p10.html#w_odata2_lbu___m_RVuc"],
["S","microc.v.html#183","microc.v.html#183","","microc.v.html#183","hierarchy-s.p10.html#w_odata2_lh___m_RVuc"],
["S","microc.v.html#184","microc.v.html#184","","microc.v.html#184","hierarchy-s.p10.html#w_odata2_lhu___m_RVuc"],
["S","microc.v.html#192","microc.v.html#192","","microc.v.html#192","hierarchy-s.p10.html#w_we_sb___m_RVuc"],
["S","microc.v.html#193","microc.v.html#193","","microc.v.html#193","hierarchy-s.p10.html#w_we_sh___m_RVuc"],
["S","microc.v.html#194","microc.v.html#194","","microc.v.html#194","hierarchy-s.p10.html#w_we_sw___m_RVuc"],
["S","microc.v.html#195","microc.v.html#195","","microc.v.html#195","hierarchy-s.p10.html#w_mic_lcmwe___m_RVuc"],
["S","microc.v.html#216","","microc.v.html#200","microc.v.html#22","hierarchy-s.p2.html#CLK___m_lm_mc"],
["S","microc.v.html#218","","microc.v.html#200","microc.v.html#156","hierarchy-s.p10.html#w_addr1___m_lm_mc"],
["S","microc.v.html#220","microc.v.html#229","","microc.v.html#229","hierarchy-s.p7.html#r_odata1___m_lm_mc"],
["S","microc.v.html#217","","microc.v.html#201","microc.v.html#195","hierarchy-s.p10.html#w_we___m_lm_mc"],
["S","microc.v.html#218","","microc.v.html#201","microc.v.html#150","hierarchy-s.p10.html#w_addr2___m_lm_mc"],
["S","microc.v.html#220","microc.v.html#236","","microc.v.html#236","hierarchy-s.p7.html#r_odata2___m_lm_mc"],
["S","microc.v.html#219","","microc.v.html#201","microc.v.html#172","hierarchy-s.p10.html#w_idata___m_lm_mc"],
["S","microc.v.html#222","microc.v.html#232","","microc.v.html#232","hierarchy-s.p5.html#mem___m_lm_mc"]
];
disabled=0;
// -->
</script>
<hr>
<table>
 <tr><td><i>This page:</i></td>
  <td><i>Created:</i></td><td><i>Mon Oct 30 14:02:56 2023</i></td></tr>
<tr>
 <td> </td>
 <td><i>From:</i></td><td><i>
../rlsoc-tn/rvsoc_src_ver053/src/microc.v</i></td></tr>
</table>
<hr>
<table width="100%"><tr><td><i>Verilog converted to html by  <a target="_top" href="http://www.burbleland.com/v2html/v2html.html">  v2html 7.30.1.3</a> 
 (written by <a href="mailto:v2html730@burbleland.com">Costas Calamvokis</a>).</i></td><td align="right"><b><a href="http://www.burbleland.com/v2html/help_7_30.html?">Help</a></b></td></tr></table><table height="90%"><tr><td></td></tr></table>
</body>
</html>

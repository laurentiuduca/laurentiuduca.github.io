<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<title>src/top.v</title>
<link rel="Stylesheet" title="v2html stylesheet" media="Screen" href="v2html.css">
</head>
<script language="JavaScript" type="text/javascript"><!--
var agt=navigator.userAgent.toLowerCase(); 
var is_nav  = ((agt.indexOf('mozilla')!=-1) &&
(agt.indexOf('spoofer')==-1) &&
(agt.indexOf('compatible') == -1) &&
(agt.indexOf('opera')==-1) &&
(agt.indexOf('webtv')==-1)); 
var is_major = parseInt(navigator.appVersion); 
var is_nav4up = (is_nav && (is_major >= 4)); 
var is_ie     = (agt.indexOf("msie") != -1); 
var is_ie4up  = (is_ie  && (is_major >= 4)); 
var is_nav5up = (is_nav && (is_major >= 5));
var dirSep = (window.location.pathname.indexOf('\\') != -1) ? '\\' : '/' ;
function setbuttons (wndw) {
var i;
var sl=wndw.loc[ wndw.document.forms[0].elements[0].selectedIndex ];
for (i=0;i<sl.length;i++) {
if(sl[i]) wndw.document.images[i].src='v2html-b1.gif';
else      wndw.document.images[i].src='v2html-b2.gif';
}
if ( wndw.document.forms[0].elements[0].options[ 
wndw.document.forms[0].elements[0].selectedIndex ].text != '-') {
wndw.document.images[i  ].src='v2html-b1.gif';
wndw.document.images[i+1].src='v2html-b1.gif';
}
else {
wndw.document.images[i  ].src='v2html-b2.gif';
wndw.document.images[i+1].src='v2html-b2.gif';
}
}
// Unindented and uncommented to save spave - look in v2html for a prettier version
var disabled=1;
if (!is_nav4up) {
var event=false; 
}
var last_link=0;     
var last_class=null; 
function qs(e,t,extra_info_index) {
var inc=0,bnum=0,i,j;
if (disabled) return false;
var sig_buttons = [ "Definition" , "Local Driver" , 
"Up to Input Driver" , "Find Source" , "Index"];
if (is_nav4up || is_ie4up) {
if (((e.which==2) && (!(e.modifiers&Event.SHIFT_MASK))) ||
((e.which==1) &&  (e.modifiers&Event.CONTROL_MASK)))   inc = 1;
else if (((e.which==2) && (e.modifiers&Event.SHIFT_MASK)) ||
((e.which==1) && (e.modifiers&Event.SHIFT_MASK))) inc = -1;
if (inc == 0 && extra_info_index == 0) { 
return true;  
}
var linkText = is_nav4up ? t.text : t.innerText;
var linkY    = is_nav4up && ! is_nav5up ? t.y    : t.offsetTop;
window.status="Searching...";
if ((last_link==-1) || (document.links[last_link]!=t)) 
for (last_link=0;last_link<document.links.length;last_link++) 
if (document.links[last_link] == t)  
break;
if (inc != 0) { 
return search(linkText,linkY,last_link,inc,1);
}
else { 
window.status="";
extra_info_index--; 
if (extra_info[extra_info_index][0] != 'S') { 
return true;
}
var w = window.open('','SignalPopUp','width=200,height=235');
if (null != w.document.forms[0]) {
if ((window.location.pathname.substring(0,window.location.pathname.lastIndexOf(dirSep)))!=
(w.pn.substring(0,w.pn.lastIndexOf(dirSep)))) {
w.close();
w = window.open('','SignalPopUp','width=200,height=235');
}
}
w.focus(); 
if (null == w.document.forms[0]) { 
var Text = '<html><head></head>';
if (is_nav4up) { 
w.loc = new Array(10);
w.sel = null;
w.pn  = window.location.pathname;
}
else {     
Text += '<script>var loc = new Array(10);<\/script>\n';
Text += '<script>var sel;<\/script>\n';
Text += '<script>var pn = opener.location.pathname;<\/script>\n';
}
Text += '<body bgcolor="white">\n';
Text += '<form>';
Text += '  <select onchange="opener.setbuttons(window);">\n';
Text += '  <option>---------------------------</option>\n';
for (j=0;j<9;j++) Text += '  <option>-</option>\n';
Text += '  </select>\n';
Text += '</form>';
Text += '<table cellspacing=0 cellpadding=0>\n';
for (var i=0;i<(extra_info[extra_info_index].length-1);i++) {
Text += hbutton(sig_buttons[i], 
'opener.location=loc[sel.selectedIndex]['+i+'];',
bnum++);
}
Text += hbutton("Search Backwards", 
'opener.search(sel.options[ sel.selectedIndex ].text,' +
'0,opener.last_link,-1,0);',bnum++);
Text += hbutton("Search Forwards",
'opener.search(sel.options[ sel.selectedIndex ].text,' +
'0,opener.last_link, 1,0);',bnum++);
Text += hbutton("Close","window.close();",bnum++);
Text += '</table>\n';
Text += '</body></html>\n';
w.document.open();
w.document.write(Text);
w.document.close();
w.document.forms[0].elements[0].options[0].text  = linkText;
w.sel = w.document.forms[0].elements[0]; 
for (j=0;j<10;j++) w.loc[j] = new Array(sig_buttons.length);  
copy_into_loc0(w,extra_info_index);
}
else {
var opts = w.document.forms[0].elements[0].options;
if ( opts.length<10 ) { 
w.loc[opts.length] = new Array;
opts.length++; 
}
for (i=opts.length-2;i>=0;i--) {
opts[i+1].text=opts[i].text;
for (var j=0;j<w.loc[i].length;j++) w.loc[i+1][j] = w.loc[i][j];
}
opts[0].text  = linkText;
copy_into_loc0(w,extra_info_index);
}
return false; 
}
}
return true;
}
function hbutton (text,action,bnum) {
return '  <tr><td><a href="" '+
'onmousedown="'+
'if (images['+bnum+'].src.match(/v2html-b2.gif/)) return false; ' +
'images['+bnum+'].src=\'v2html-b3.gif\';" '+
'onmouseup="'+
'if (images['+bnum+'].src.match(/v2html-b2.gif/)) return false; ' +
'images['+bnum+'].src=\'v2html-b1.gif\';" '+
'onclick="'+
'if (images['+bnum+'].src.match(/v2html-b2.gif/)) return false; ' +
action + 
' return false;">'+
'<img border=0 src="v2html-b1.gif"></a></td>' +
'<td style="font-family:sans-serif; font-weight:bold; font-size:14px;"> '+text+'</td></tr>\n';
}
function copy_into_loc0 (w,extra_info_index) {
for (var i=1;i<extra_info[extra_info_index].length;i++) {
w.loc[0][i-1] = extra_info[extra_info_index][i];
}
w.document.forms[0].elements[0].selectedIndex=1;
w.document.forms[0].elements[0].selectedIndex=0;
setbuttons(w);
}
function search(text,y,i,inc,relative) {
var nextpage,wrappage,linkText,linkY;
window.status="Searching...";
if (last_class) document.links[i].className=last_class;
while (1) {
for (i+=inc;i<document.links.length && i>=0;i+=inc) {
linkText = is_nav4up ? document.links[i].text : document.links[i].innerText;
linkY    = is_nav4up && ! is_nav5up ? document.links[i].y    : document.links[i].offsetTop;
if ((linkText == text) && (linkY != y)) {
window.status="";
if (is_nav4up) 
if (relative) window.scrollBy(0,linkY - y);
else          window.scrollTo(0,linkY); 
else if (is_ie4up)
document.links[i].scrollIntoView(true); 
last_link=i;
last_class=document.links[i].className;
document.links[i].className='HI';
return false;
}
}
nextpage = (inc==1) ? next_page() : prev_page();
wrappage = (inc==1) ? first_page() : last_page();
if (nextpage!="" || wrappage!="") {
if (nextpage=="") { 
if (!confirm(text + " not found. Search again from "+((inc==1)?"first":"last")+" page?"))
return false;
nextpage=wrappage;
}
location=nextpage+ "?" + escape(text) + "&" + ( y - window.pageYOffset ) + "&" + inc;
return false;
}
if (confirm(text + " not found. Search again from "+((inc==1)?"start":"end")+"?")) {
if (inc==1) i=-1;
else i=document.links.length;
} else return false;
}
return true;
}
function loadqs() {
var opt=location.search, text="", s="", y=0, si=0, inc=1;
if (opt.length==0) return true;  
for (var i=1;i<opt.length;i++) { 
if (opt.charAt(i) != "&") 
s += opt.charAt(i);
else {
if (text=="") text=unescape(s);
else             y=s;
s="";
}
}
if (text=="") return true;
if (s == "-1") { si=document.links.length-1; inc=-1; }
window.scrollTo(0,0);
search(text,y,si,inc);
return true;
}
// -->
</script>
<body onload='loadqs();'>
<script language="JavaScript"type="text/javascript"><!--
function prev_page() { return ""; }
function last_page() { return "top.v.p2.html"; }
// -->
</script>
<center><table class=NB cols=7 ><tr><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy.html';"><a target="_top" href="hierarchy.html">Hierarchy</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-f.html';"><a target="_top" href="hierarchy-f.html">Files</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-m.html';"><a target="_top" href="hierarchy-m.html">Modules</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-s.html';"><a target="_top" href="hierarchy-s.html">Signals</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-t.html';"><a target="_top" href="hierarchy-t.html">Tasks</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-fn.html';"><a target="_top" href="hierarchy-fn.html">Functions</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='http://www.burbleland.com/v2html/help_7_30.html?';"><a target="_top" href="http://www.burbleland.com/v2html/help_7_30.html?">Help</a></td></tr></table></center>
<center><table class=NB cols=2 ><tr><td align="center" width="50%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';" ><font color="#808080">1</font></td><td align="center" width="50%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='top.v.p2.html';"><a target="_top" href="top.v.p2.html">2</a></td></tr></table></center>
<pre>
<span class=C>/* Modified by Laurentiu-Cristian Duca, 2021-12-20
 * - memory model similar to dram memory controller with DRAM_SIM
 * or simple memory model
 * - debug with RAM_DEBUG
 * - allow ICARUS simulation
 */</span>
<span class=C>/**************************************************************************************************/</span>
<span class=C>/**** RVSoC (Mini Kuroda/RISC-V)                       since 2018-08-07   ArchLab. TokyoTech   ****/</span>
<span class=C>/**** top module and simulation module v0.01                                                   ****/</span>
<span class=C>/**************************************************************************************************/</span>
<span class=M>`default_nettype</span> none
<span class=C>/**************************************************************************************************/</span>
<span class=M>`include</span> <a  onClick="return qs(event,this,0)"  class=S href="define.vh.html">&quot;define.vh&quot;</a>

<span class=C>/**************************************************************************************************/</span>
<span class=P>`ifdef ICARUS
</span><span class=P>module m_topsim();
</span><span class=P>    reg CLK = 0;
</span><span class=P>    reg RST_X;
</span>
<span class=P>    initial forever #50 CLK = ~CLK;
</span>
<span class=P>    initial begin
</span><span class=P>        #50  RST_X = 0;
</span><span class=P>        #300 RST_X = 1;
</span><span class=P>    end
</span>
<span class=P>    initial begin
</span><span class=P>	$dumpfile(</span><span class=P>&quot;signals.vcd&quot;</span><span class=P>);
</span><span class=P>        $dumpvars(0, m_topsim);
</span><span class=P>    end
</span><span class=M>`else</span>
<a name="m_topsim"></a><span class=K>module</span> <span class=MM>m_topsim</span><a  href="hierarchy-m.html#m_topsim"><img align=top border=0 alt="Index" src="v2html-i.gif"></a>(<a  onClick="return qs(event,this,1)"  href="top.v.html#34">CLK</a>, <a  onClick="return qs(event,this,2)"  href="top.v.html#34">RST_X</a>);
<a name="34"></a>    <span class=K>input</span> <span class=K>reg</span> <a  onClick="return qs(event,this,1)"  href="top.v.html#34">CLK</a>, <a  onClick="return qs(event,this,2)"  href="top.v.html#34">RST_X</a>;
<span class=M>`endif</span>

<a name="37"></a>    <span class=K>wire</span> <a  onClick="return qs(event,this,3)"  class=SW href="top.v.html#232">w_halt</a>;

<a name="39"></a>    <span class=K>wire</span> <a  onClick="return qs(event,this,4)"  class=SW href="top.v.html#160">w_finish</a>;

<a name="41"></a>    <span class=K>wire</span> [31:0] <a  onClick="return qs(event,this,5)"  class=SW href="top.v.html#158">w_insn_data</a>, <a  onClick="return qs(event,this,6)"  class=SW href="top.v.html#233">w_insn_addr</a>;
<a name="42"></a>    <span class=K>wire</span> [31:0] <a  onClick="return qs(event,this,7)"  class=SW href="top.v.html#159">w_data_data</a>, <a  onClick="return qs(event,this,8)"  class=SW href="top.v.html#237">w_data_wdata</a>, <a  onClick="return qs(event,this,9)"  class=SW href="top.v.html#234">w_data_addr</a>;
<a name="43"></a>    <span class=K>wire</span>        <a  onClick="return qs(event,this,10)"  class=SW href="top.v.html#238">w_data_we</a>;
<a name="44"></a>    <span class=K>wire</span> [2:0]  <a  onClick="return qs(event,this,11)"  class=SW href="top.v.html#239">w_data_ctrl</a>;

<a name="46"></a>    <span class=K>wire</span> [31:0] <a  onClick="return qs(event,this,12)"  class=SW href="top.v.html#240">w_priv</a>, <a  onClick="return qs(event,this,13)"  class=SW href="top.v.html#241">w_satp</a>, <a  onClick="return qs(event,this,14)"  class=SW href="top.v.html#242">w_mstatus</a>;
<a name="47"></a>    <span class=K>wire</span> [63:0] <a  onClick="return qs(event,this,15)"  class=SW href="top.v.html#243">w_mtime</a>, <a  onClick="return qs(event,this,16)"  class=SW href="top.v.html#244">w_mtimecmp</a>, <a  onClick="return qs(event,this,17)"  class=SW href="top.v.html#166">w_wmtimecmp</a>;
<a name="48"></a>    <span class=K>wire</span>        <a  onClick="return qs(event,this,18)"  class=SW href="top.v.html#167">w_clint_we</a>;
<a name="49"></a>    <span class=K>wire</span> [31:0] <a  onClick="return qs(event,this,19)"  class=SW href="top.v.html#247">w_mip</a>, <a  onClick="return qs(event,this,20)"  class=SW href="top.v.html#169">w_wmip</a>;
<a name="50"></a>    <span class=K>wire</span>        <a  onClick="return qs(event,this,21)"  class=SW href="top.v.html#170">w_plic_we</a>;
<a name="51"></a>    <span class=K>wire</span>        <a  onClick="return qs(event,this,22)"  class=SW href="top.v.html#171">w_busy</a>;
<a name="52"></a>    <span class=K>wire</span> [31:0] <a  onClick="return qs(event,this,23)"  class=SW href="top.v.html#172">w_pagefault</a>;
<a name="53"></a>    <span class=K>wire</span> [1:0]  <a  onClick="return qs(event,this,24)"  class=SW href="top.v.html#252">w_tlb_req</a>;
<a name="54"></a>    <span class=K>wire</span>        <a  onClick="return qs(event,this,25)"  class=SW href="top.v.html#253">w_tlb_flush</a>;
<a name="55"></a>    <span class=K>wire</span>        <a  onClick="return qs(event,this,26)"  class=SW href="top.v.html#175">w_txd</a>;
<a name="56"></a>    <span class=K>wire</span>        <a  onClick="return qs(event,this,27)"  class=SW href="top.v.html#56">w_rxd</a>;
<a name="57"></a>    <span class=K>wire</span>        <a  onClick="return qs(event,this,28)"  class=SW href="top.v.html#177">w_init_done</a>;
<a name="58"></a>    <span class=K>wire</span>        <a  onClick="return qs(event,this,29)"  class=SW href="top.v.html#257">w_init_stage</a>;

<a name="60"></a>    <span class=K>wire</span>        <a  onClick="return qs(event,this,30)"  class=SW href="top.v.html#60">CORE_RST_X</a> = <a  onClick="return qs(event,this,2)"  href="top.v.html#34">RST_X</a> &amp; <a  onClick="return qs(event,this,28)"  class=SW href="top.v.html#177">w_init_done</a>;

<span class=M>`ifndef</span> <span class=D>ARTYA7</span>
<a name="63"></a>    <span class=K>wire</span> [15:0] <a  onClick="return qs(event,this,31)"  class=SW href="top.v.html#63">ddr2_dq</a>;
<a name="64"></a>    <span class=K>wire</span> [1:0]  <a  onClick="return qs(event,this,32)"  class=SW href="top.v.html#64">ddr2_dqs_n</a>;
<a name="65"></a>    <span class=K>wire</span> [1:0]  <a  onClick="return qs(event,this,33)"  class=SW href="top.v.html#65">ddr2_dqs_p</a>;
<a name="66"></a>    <span class=K>wire</span> [12:0] <a  onClick="return qs(event,this,34)"  class=SW href="top.v.html#186">ddr2_addr</a>;
<a name="67"></a>    <span class=K>wire</span> [2:0]  <a  onClick="return qs(event,this,35)"  class=SW href="top.v.html#187">ddr2_ba</a>;
<a name="68"></a>    <span class=K>wire</span>        <a  onClick="return qs(event,this,36)"  class=SW href="top.v.html#188">ddr2_ras_n</a>;
<a name="69"></a>    <span class=K>wire</span>        <a  onClick="return qs(event,this,37)"  class=SW href="top.v.html#189">ddr2_cas_n</a>;
<a name="70"></a>    <span class=K>wire</span>        <a  onClick="return qs(event,this,38)"  class=SW href="top.v.html#190">ddr2_we_n</a>;
<a name="71"></a>    <span class=K>wire</span>        <a  onClick="return qs(event,this,39)"  class=SW href="top.v.html#191">ddr2_ck_p</a>;
<a name="72"></a>    <span class=K>wire</span>        <a  onClick="return qs(event,this,40)"  class=SW href="top.v.html#192">ddr2_ck_n</a>;
<a name="73"></a>    <span class=K>wire</span>        <a  onClick="return qs(event,this,41)"  class=SW href="top.v.html#193">ddr2_cke</a>;
<a name="74"></a>    <span class=K>wire</span>        <a  onClick="return qs(event,this,42)"  class=SW href="top.v.html#194">ddr2_cs_n</a>;
<a name="75"></a>    <span class=K>wire</span> [1:0]  <a  onClick="return qs(event,this,43)"  class=SW href="top.v.html#195">ddr2_dm</a>;
<a name="76"></a>    <span class=K>wire</span>        <a  onClick="return qs(event,this,44)"  class=SW href="top.v.html#196">ddr2_odt</a>;
<span class=P>`else
</span><span class=P>    wire ref_clk;
</span><span class=P>    wire [15:0] ddr3_dq;
</span><span class=P>    wire [1:0]  ddr3_dqs_n;
</span><span class=P>    wire [1:0]  ddr3_dqs_p;
</span><span class=P>    wire [13:0] ddr3_addr;
</span><span class=P>    wire [2:0]  ddr3_ba;
</span><span class=P>    wire        ddr3_ras_n;
</span><span class=P>    wire        ddr3_cas_n;
</span><span class=P>    wire        ddr3_we_n;
</span><span class=P>    wire        ddr3_ck_p;
</span><span class=P>    wire        ddr3_ck_n;
</span><span class=P>    wire        ddr3_reset_n;
</span><span class=P>    wire        ddr3_cke;
</span><span class=P>    wire        ddr3_cs_n;
</span><span class=P>    wire [1:0]  ddr3_dm;
</span><span class=P>    wire        ddr3_odt;
</span><span class=M>`endif</span>

<a name="96"></a>    <span class=K>wire</span> [7:0]  <a  onClick="return qs(event,this,45)"  class=SW href="top.v.html#218">w_uart_data</a>;
<a name="97"></a>    <span class=K>wire</span>        <a  onClick="return qs(event,this,46)"  class=SW href="top.v.html#219">w_uart_we</a>;

<a name="99"></a>    <span class=K>wire</span> [15:0] <a  onClick="return qs(event,this,47)"  class=SW href="top.v.html#220">w_led</a>;

    <span class=C>/**********************************************************************************************/</span>

<a name="103"></a>    <span class=K>reg</span>       <a  onClick="return qs(event,this,48)"  class=SR href="top.v.html#103">r_uart_busy</a>  = 0;
<a name="104"></a>    <span class=K>reg</span> [3:0] <a  onClick="return qs(event,this,49)"  class=SR href="top.v.html#104">r_uart_count</a> = 0;
<a name="105"></a>    <span class=K>reg</span> [3:0] <a  onClick="return qs(event,this,50)"  class=SR href="top.v.html#105">r_uart_cycle</a> = 0;
<a name="106"></a>    <span class=K>reg</span> [7:0] <a  onClick="return qs(event,this,51)"  class=SR href="top.v.html#106">r_uart_data</a>  = 0;

<span class=P>`ifdef USE_UART
</span><span class=P>    always@(posedge CLK) begin
</span><span class=P>        if (w_init_done) begin
</span><span class=P>            if (!r_uart_busy &amp;&amp; !w_txd) begin
</span><span class=P>                r_uart_busy  &lt;= 1;
</span><span class=P>                r_uart_data  &lt;= 0;
</span><span class=P>                r_uart_count &lt;= 0;
</span><span class=P>                r_uart_cycle &lt;= 1;
</span><span class=P>            end else if (r_uart_busy &amp;&amp; (r_uart_count == 8) &amp;&amp; w_txd) begin
</span><span class=P>                r_uart_count &lt;= 0;
</span><span class=P>                r_uart_busy  &lt;= 0;
</span><span class=P>                r_uart_cycle &lt;= 0;
</span><span class=P>                $write(</span><span class=P>&quot;%c&quot;</span><span class=P>, r_uart_data);
</span><span class=P>    `ifndef VERILATOR
</span><span class=P>                $fflush();
</span><span class=P>    `endif
</span><span class=P>            end else if (r_uart_busy &amp;&amp; (r_uart_cycle == 8)) begin
</span><span class=P>                r_uart_count &lt;= r_uart_count + 1;
</span><span class=P>                r_uart_cycle &lt;= 1;
</span><span class=P>            end else if (r_uart_busy &amp;&amp; (r_uart_cycle == 4) &amp;&amp; (r_uart_count &gt; 0)) begin
</span><span class=P>                r_uart_cycle &lt;= r_uart_cycle + 1;
</span><span class=P>                r_uart_data  &lt;= {w_txd,r_uart_data[7:1]};
</span><span class=P>            end else if (r_uart_busy) begin
</span><span class=P>                r_uart_cycle &lt;= r_uart_cycle + 1;
</span><span class=P>            end
</span><span class=P>        end
</span><span class=P>    end
</span><span class=M>`else</span>
    <span class=K>always</span>@(<span class=K>posedge</span> <a  onClick="return qs(event,this,1)"  href="top.v.html#34">CLK</a>) <span class=K>begin</span>
        <span class=K>if</span>(<a  onClick="return qs(event,this,46)"  class=SW href="top.v.html#97">w_uart_we</a>) <span class=K>begin</span>
            <span class=ST>$write</span>(<span class=S>&quot;%c&quot;</span>, <a  onClick="return qs(event,this,45)"  class=SW href="top.v.html#96">w_uart_data</a>);
    <span class=M>`ifndef</span> <span class=D>VERILATOR</span>
            <span class=ST>$fflush</span>();
    <span class=M>`endif</span>
        <span class=K>end</span>
    <span class=K>end</span>
<span class=M>`endif</span>

<a name="146"></a>    <span class=K>wire</span> [2:0] <a  onClick="return qs(event,this,52)"  class=SW href="top.v.html#224">w_init_state</a>;
<a name="147"></a>    <span class=K>wire</span> <a  onClick="return qs(event,this,53)"  class=SW href="top.v.html#225">w_pl_init_we</a>;

    <span class=C>/**********************************************************************************************/</span>
<a name="m_topsim_mmu"></a>    <a  onClick="return qs(event,this,0)"  class=MM href="mmu.v.html#m_mmu">m_mmu</a> mmu(
        <span class=SI>.CLK</span>            (<a  onClick="return qs(event,this,1)"  href="top.v.html#34">CLK</a>),
        <span class=SI>.RST_X</span>          (<a  onClick="return qs(event,this,2)"  href="top.v.html#34">RST_X</a>),
        <span class=SI>.w_insn_addr</span>    (<a  onClick="return qs(event,this,6)"  class=SW href="top.v.html#233">w_insn_addr</a>),
        <span class=SI>.w_data_addr</span>    (<a  onClick="return qs(event,this,9)"  class=SW href="top.v.html#234">w_data_addr</a>),
        <span class=SI>.w_data_wdata</span>   (<a  onClick="return qs(event,this,8)"  class=SW href="top.v.html#237">w_data_wdata</a>),
        <span class=SI>.w_data_we</span>      (<a  onClick="return qs(event,this,10)"  class=SW href="top.v.html#238">w_data_we</a>),
        <span class=SI>.w_data_ctrl</span>    (<a  onClick="return qs(event,this,11)"  class=SW href="top.v.html#239">w_data_ctrl</a>),
<a name="158"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#366">.w_insn_data</a>    (<a  onClick="return qs(event,this,5)"  class=SW href="top.v.html#41">w_insn_data</a>),
<a name="159"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#420">.w_data_data</a>    (<a  onClick="return qs(event,this,7)"  class=SW href="top.v.html#42">w_data_data</a>),
<a name="160"></a>        <a  onClick="return qs(event,this,0)"  class=SOR href="mmu.v.html#86">.r_finish</a>       (<a  onClick="return qs(event,this,4)"  class=SW href="top.v.html#39">w_finish</a>),
        <span class=SI>.w_priv</span>         (<a  onClick="return qs(event,this,12)"  class=SW href="top.v.html#240">w_priv</a>),
        <span class=SI>.w_satp</span>         (<a  onClick="return qs(event,this,13)"  class=SW href="top.v.html#241">w_satp</a>),
        <span class=SI>.w_mstatus</span>      (<a  onClick="return qs(event,this,14)"  class=SW href="top.v.html#242">w_mstatus</a>),
        <span class=SI>.w_mtime</span>        (<a  onClick="return qs(event,this,15)"  class=SW href="top.v.html#243">w_mtime</a>),
        <span class=SI>.w_mtimecmp</span>     (<a  onClick="return qs(event,this,16)"  class=SW href="top.v.html#244">w_mtimecmp</a>),
<a name="166"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#636">.w_wmtimecmp</a>    (<a  onClick="return qs(event,this,17)"  class=SW href="top.v.html#47">w_wmtimecmp</a>),
<a name="167"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#640">.w_clint_we</a>     (<a  onClick="return qs(event,this,18)"  class=SW href="top.v.html#48">w_clint_we</a>),
        <span class=SI>.w_mip</span>          (<a  onClick="return qs(event,this,19)"  class=SW href="top.v.html#247">w_mip</a>),
<a name="169"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#628">.w_wmip</a>         (<a  onClick="return qs(event,this,20)"  class=SW href="top.v.html#49">w_wmip</a>),
<a name="170"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#627">.w_plic_we</a>      (<a  onClick="return qs(event,this,21)"  class=SW href="top.v.html#50">w_plic_we</a>),
<a name="171"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#657">.w_proc_busy</a>    (<a  onClick="return qs(event,this,22)"  class=SW href="top.v.html#51">w_busy</a>),
<a name="172"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#215">.w_pagefault</a>    (<a  onClick="return qs(event,this,23)"  class=SW href="top.v.html#52">w_pagefault</a>),
        <span class=SI>.w_tlb_req</span>      (<a  onClick="return qs(event,this,24)"  class=SW href="top.v.html#252">w_tlb_req</a>),
        <span class=SI>.w_tlb_flush</span>    (<a  onClick="return qs(event,this,25)"  class=SW href="top.v.html#253">w_tlb_flush</a>),
<a name="175"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#758">.w_txd</a>          (<a  onClick="return qs(event,this,26)"  class=SW href="top.v.html#55">w_txd</a>),
        <span class=SI>.w_rxd</span>          (<a  onClick="return qs(event,this,27)"  class=SW href="top.v.html#56">w_rxd</a>),
<a name="177"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#800">.w_init_done</a>    (<a  onClick="return qs(event,this,28)"  class=SW href="top.v.html#57">w_init_done</a>),
        <span class=C>// input clk, rst (active-low)
</span>        <span class=SI>.mig_clk</span>        (1'b0),
        <span class=SI>.mig_rst_x</span>      (1'b0),
        <span class=C>// memory interface ports
</span><span class=M>`ifndef</span> <span class=D>ARTYA7</span>
        <span class=SIO>.ddr2_dq</span>        (<a  onClick="return qs(event,this,31)"  class=SW href="top.v.html#63">ddr2_dq</a>),
        <span class=SIO>.ddr2_dqs_n</span>     (<a  onClick="return qs(event,this,32)"  class=SW href="top.v.html#64">ddr2_dqs_n</a>),
        <span class=SIO>.ddr2_dqs_p</span>     (<a  onClick="return qs(event,this,33)"  class=SW href="top.v.html#65">ddr2_dqs_p</a>),
<a name="186"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#977">.ddr2_addr</a>      (<a  onClick="return qs(event,this,34)"  class=SW href="top.v.html#66">ddr2_addr</a>),
<a name="187"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#978">.ddr2_ba</a>        (<a  onClick="return qs(event,this,35)"  class=SW href="top.v.html#67">ddr2_ba</a>),
<a name="188"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#979">.ddr2_ras_n</a>     (<a  onClick="return qs(event,this,36)"  class=SW href="top.v.html#68">ddr2_ras_n</a>),
<a name="189"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#980">.ddr2_cas_n</a>     (<a  onClick="return qs(event,this,37)"  class=SW href="top.v.html#69">ddr2_cas_n</a>),
<a name="190"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#981">.ddr2_we_n</a>      (<a  onClick="return qs(event,this,38)"  class=SW href="top.v.html#70">ddr2_we_n</a>),
<a name="191"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#982">.ddr2_ck_p</a>      (<a  onClick="return qs(event,this,39)"  class=SW href="top.v.html#71">ddr2_ck_p</a>),
<a name="192"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#983">.ddr2_ck_n</a>      (<a  onClick="return qs(event,this,40)"  class=SW href="top.v.html#72">ddr2_ck_n</a>),
<a name="193"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#984">.ddr2_cke</a>       (<a  onClick="return qs(event,this,41)"  class=SW href="top.v.html#73">ddr2_cke</a>),
<a name="194"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#985">.ddr2_cs_n</a>      (<a  onClick="return qs(event,this,42)"  class=SW href="top.v.html#74">ddr2_cs_n</a>),
<a name="195"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#986">.ddr2_dm</a>        (<a  onClick="return qs(event,this,43)"  class=SW href="top.v.html#75">ddr2_dm</a>),
<a name="196"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#987">.ddr2_odt</a>       (<a  onClick="return qs(event,this,44)"  class=SW href="top.v.html#76">ddr2_odt</a>),
<span class=P>`else
</span><span class=P>	.ref_clk        (ref_clk),
</span><span class=P>        .ddr3_dq        (ddr3_dq),
</span><span class=P>        .ddr3_dqs_n     (ddr3_dqs_n),
</span><span class=P>        .ddr3_dqs_p     (ddr3_dqs_p),
</span><span class=P>        .ddr3_addr      (ddr3_addr),
</span><span class=P>        .ddr3_ba        (ddr3_ba),
</span><span class=P>        .ddr3_ras_n     (ddr3_ras_n),
</span><span class=P>        .ddr3_cas_n     (ddr3_cas_n),
</span><span class=P>        .ddr3_we_n      (ddr3_we_n),
</span><span class=P>        .ddr3_ck_p      (ddr3_ck_p),
</span><span class=P>        .ddr3_ck_n      (ddr3_ck_n),
</span><span class=P>	.ddr3_reset_n   (ddr3_reset_n),
</span><span class=P>        .ddr3_cke       (ddr3_cke),
</span><span class=P>        .ddr3_cs_n      (ddr3_cs_n),
</span><span class=P>        .ddr3_dm        (ddr3_dm),
</span><span class=P>        .ddr3_odt       (ddr3_odt),
</span><span class=M>`endif</span>
        <span class=C>// output clk, rst (active-low)
</span>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.p2.html#1006">.o_clk</a>          (),
        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.p2.html#1007">.o_rst_x</a>        (),
<a name="218"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#718">.w_uart_data</a>    (<a  onClick="return qs(event,this,45)"  class=SW href="top.v.html#96">w_uart_data</a>),
<a name="219"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#719">.w_uart_we</a>      (<a  onClick="return qs(event,this,46)"  class=SW href="top.v.html#97">w_uart_we</a>),
<a name="220"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.p2.html#1015">.w_led</a>          (<a  onClick="return qs(event,this,47)"  class=SW href="top.v.html#99">w_led</a>),
        <span class=SI>.w_init_stage</span>   (<a  onClick="return qs(event,this,29)"  class=SW href="top.v.html#257">w_init_stage</a>),
        <a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#750">.w_checksum</a>     (),
        <span class=SI>.w_debug_btnd</span>   (1'b0),
<a name="224"></a>	<a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#798">.w_init_state</a>   (<a  onClick="return qs(event,this,52)"  class=SW href="top.v.html#146">w_init_state</a>),
<a name="225"></a>	<a  onClick="return qs(event,this,0)"  class=SO href="mmu.v.html#725">.w_pl_init_we</a>   (<a  onClick="return qs(event,this,53)"  class=SW href="top.v.html#147">w_pl_init_we</a>)
    );

<a name="m_topsim_p"></a>    <a  onClick="return qs(event,this,0)"  class=MM href="rvcorem.v.html#m_RVCoreM">m_RVCoreM</a> p(
        <span class=SI>.CLK</span>            (<a  onClick="return qs(event,this,1)"  href="top.v.html#34">CLK</a>),
        <span class=SI>.RST_X</span>          (<a  onClick="return qs(event,this,30)"  class=SW href="top.v.html#60">CORE_RST_X</a>),
        <span class=SI>.w_stall</span>        (1'b0),
<a name="232"></a>        <a  onClick="return qs(event,this,0)"  class=SOR href="rvcorem.v.html#847">.r_halt</a>         (<a  onClick="return qs(event,this,3)"  class=SW href="top.v.html#37">w_halt</a>),
<a name="233"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="rvcorem.v.html#202">.w_insn_addr</a>    (<a  onClick="return qs(event,this,6)"  class=SW href="top.v.html#41">w_insn_addr</a>),
<a name="234"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="rvcorem.v.html#389">.w_data_addr</a>    (<a  onClick="return qs(event,this,9)"  class=SW href="top.v.html#42">w_data_addr</a>),
        <span class=SI>.w_insn_data</span>    (<a  onClick="return qs(event,this,5)"  class=SW href="top.v.html#158">w_insn_data</a>),
        <span class=SI>.w_data_data</span>    (<a  onClick="return qs(event,this,7)"  class=SW href="top.v.html#159">w_data_data</a>),
<a name="237"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="rvcorem.v.html#419">.w_data_wdata</a>   (<a  onClick="return qs(event,this,8)"  class=SW href="top.v.html#42">w_data_wdata</a>),
<a name="238"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="rvcorem.v.html#838">.w_data_we</a>      (<a  onClick="return qs(event,this,10)"  class=SW href="top.v.html#43">w_data_we</a>),
<a name="239"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="rvcorem.v.html#388">.w_data_ctrl</a>    (<a  onClick="return qs(event,this,11)"  class=SW href="top.v.html#44">w_data_ctrl</a>),
<a name="240"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="rvcorem.v.html#839">.w_priv</a>         (<a  onClick="return qs(event,this,12)"  class=SW href="top.v.html#46">w_priv</a>),
<a name="241"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="rvcorem.v.html#840">.w_satp</a>         (<a  onClick="return qs(event,this,13)"  class=SW href="top.v.html#46">w_satp</a>),
<a name="242"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="rvcorem.v.html#841">.w_mstatus</a>      (<a  onClick="return qs(event,this,14)"  class=SW href="top.v.html#46">w_mstatus</a>),
<a name="243"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="rvcorem.v.html#842">.w_mtime</a>        (<a  onClick="return qs(event,this,15)"  class=SW href="top.v.html#47">w_mtime</a>),
<a name="244"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="rvcorem.v.html#843">.w_mtimecmp</a>     (<a  onClick="return qs(event,this,16)"  class=SW href="top.v.html#47">w_mtimecmp</a>),
        <span class=SI>.w_wmtimecmp</span>    (<a  onClick="return qs(event,this,17)"  class=SW href="top.v.html#166">w_wmtimecmp</a>),
        <span class=SI>.w_clint_we</span>     (<a  onClick="return qs(event,this,18)"  class=SW href="top.v.html#167">w_clint_we</a>),
<a name="247"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="rvcorem.v.html#844">.w_mip</a>          (<a  onClick="return qs(event,this,19)"  class=SW href="top.v.html#49">w_mip</a>),
        <span class=SI>.w_wmip</span>         (<a  onClick="return qs(event,this,20)"  class=SW href="top.v.html#169">w_wmip</a>),
        <span class=SI>.w_plic_we</span>      (<a  onClick="return qs(event,this,21)"  class=SW href="top.v.html#170">w_plic_we</a>),
        <span class=SI>.w_busy</span>         (<a  onClick="return qs(event,this,22)"  class=SW href="top.v.html#171">w_busy</a>),
        <span class=SI>.w_pagefault</span>    (<a  onClick="return qs(event,this,23)"  class=SW href="top.v.html#172">w_pagefault</a>),
<a name="252"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="rvcorem.v.html#837">.w_tlb_req</a>      (<a  onClick="return qs(event,this,24)"  class=SW href="top.v.html#53">w_tlb_req</a>),
<a name="253"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="rvcorem.v.html#778">.w_tlb_flush</a>    (<a  onClick="return qs(event,this,25)"  class=SW href="top.v.html#54">w_tlb_flush</a>),
        <a  onClick="return qs(event,this,0)"  class=SO href="rvcorem.v.html#850">.w_core_pc</a>      (),
        <a  onClick="return qs(event,this,0)"  class=SO href="rvcorem.v.html#851">.w_core_ir</a>      (),
        <a  onClick="return qs(event,this,0)"  class=SO href="rvcorem.v.html#852">.w_core_odata</a>   (),
<a name="257"></a>        <a  onClick="return qs(event,this,0)"  class=SO href="rvcorem.v.html#176">.w_init_stage</a>   (<a  onClick="return qs(event,this,29)"  class=SW href="top.v.html#58">w_init_stage</a>)
    );

    <span class=C>/**********************************************************************************************/</span>
    <span class=K>always</span>@(<span class=K>posedge</span> <a  onClick="return qs(event,this,1)"  href="top.v.html#34">CLK</a>) <span class=K>if</span> (<a  onClick="return qs(event,this,3)"  class=SW href="top.v.html#37">w_halt</a>) <span class=K>begin</span> <span class=ST>$write</span>(<span class=S>&quot;HALT detect! at PC:%x\n&quot;</span>, p.pc); <span class=ST>$finish</span>(); <span class=K>end</span>
<a name="262"></a>    <span class=K>reg</span> <a  onClick="return qs(event,this,54)"  class=SR href="top.v.html#263">r_finish</a> = 0;
<a name="263"></a>    <span class=K>always</span>@(<span class=K>posedge</span> <a  onClick="return qs(event,this,1)"  href="top.v.html#34">CLK</a>) <a  onClick="return qs(event,this,54)"  class=SR href="top.v.html#262">r_finish</a> &lt;= <a  onClick="return qs(event,this,4)"  class=SW href="top.v.html#160">w_finish</a>;
    <span class=K>always</span>@(<span class=K>posedge</span> <a  onClick="return qs(event,this,1)"  href="top.v.html#34">CLK</a>) <span class=K>if</span> (<a  onClick="return qs(event,this,54)"  class=SR href="top.v.html#262">r_finish</a> &amp; !<a  onClick="return qs(event,this,48)"  class=SR href="top.v.html#103">r_uart_busy</a>) <span class=K>begin</span>
        <span class=ST>$write</span>(<span class=S>&quot;FINISH!\n&quot;</span>);
<span class=P>`ifdef DEBUG
</span><span class=P>        if (p.mtime &lt; 90000001) $fclose(fp);
</span><span class=M>`endif</span>
        <span class=ST>$finish</span>();
    <span class=K>end</span>

    <span class=C>// LOAD
</span><a name="273"></a>    <span class=K>integer</span> <a  onClick="return qs(event,this,55)"  class=SIT href="top.v.html#273">i</a>,<a  onClick="return qs(event,this,56)"  class=SIT href="top.v.html#297">j</a>;
    <span class=C>//integer k;
</span><a name="275"></a>    <span class=K>reg</span>  [7:0] <a  onClick="return qs(event,this,57)"  class=SR href="top.v.html#275">mem_bbl</a> [0:<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#206">BBL_SIZE</a>-1];
<a name="276"></a>    <span class=K>reg</span>  [7:0] <a  onClick="return qs(event,this,58)"  class=SR href="top.v.html#276">mem_mc</a>[0:<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#197">MC_MEM_SIZE</a>-1];
<a name="277"></a>    <span class=K>reg</span>  [7:0] <a  onClick="return qs(event,this,59)"  class=SR href="top.v.html#277">mem_disk</a>[0:<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#169">DISK_SIZE</a>-1];
    <span class=K>initial</span> <span class=K>begin</span>
<span class=M>`ifndef</span> <span class=D>VERILATOR</span>
    #1
<span class=M>`endif</span>
<span class=M>`ifdef</span> <a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#29">LINUX</a>
        <span class=C>/*$write(&quot;Load micro-ctrl program: %s\n&quot;, `MC_PROG);
        $readmemh(`MC_PROG, mem_mc);
        j=0;

        for(i=0;i&lt;`MC_MEM_SIZE;i=i+4) begin
            mmu.mc.LCMEM.mem1.mem[j]=mem_mc[i];
            mmu.mc.LCMEM.mem2.mem[j]=mem_mc[i+1];
            mmu.mc.LCMEM.mem3.mem[j]=mem_mc[i+2];
            mmu.mc.LCMEM.mem4.mem[j]=mem_mc[i+3];
            j=j+1;
        end*/</span>
        <span class=ST>$write</span>(<span class=S>&quot;Load image file: %s\n&quot;</span>, <span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#39">IMAGE_FILE</a>);
        <span class=ST>$readmemh</span>(<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#39">IMAGE_FILE</a>, <a  onClick="return qs(event,this,59)"  class=SR href="top.v.html#277">mem_disk</a>);
        <span class=C>//j=`BBL_SIZE/4;
</span><a name="297"></a>        <a  onClick="return qs(event,this,56)"  class=SIT href="top.v.html#273">j</a>=<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#206">BBL_SIZE</a>;

        <span class=C>/*for(i=0;i&lt;`DISK_SIZE;i=i+4) begin
            mmu.idbmem.idbmem.mem1.mem[j]=mem_disk[i];
            mmu.idbmem.idbmem.mem2.mem[j]=mem_disk[i+1];
            mmu.idbmem.idbmem.mem3.mem[j]=mem_disk[i+2];
            mmu.idbmem.idbmem.mem4.mem[j]=mem_disk[i+3];
            j=j+1;
        end*/</span>
        <span class=K>for</span>(<a  onClick="return qs(event,this,55)"  class=SIT href="top.v.html#273">i</a>=0;<a  onClick="return qs(event,this,55)"  class=SIT href="top.v.html#273">i</a>&lt;<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#169">DISK_SIZE</a>;<a  onClick="return qs(event,this,55)"  class=SIT href="top.v.html#273">i</a>=<a  onClick="return qs(event,this,55)"  class=SIT href="top.v.html#273">i</a>+1) <span class=K>begin</span>
<span class=P>`ifdef SKIP_CACHE
</span><span class=P>	    mmu.idbmem.idbmem.mem[j]=mem_disk[i];
</span><span class=M>`else</span>
	    mmu.idbmem.cache_ctrl.idbmem.mem[<a  onClick="return qs(event,this,56)"  class=SIT href="top.v.html#297">j</a>]=<a  onClick="return qs(event,this,59)"  class=SR href="top.v.html#277">mem_disk</a>[<a  onClick="return qs(event,this,55)"  class=SIT href="top.v.html#273">i</a>];
<span class=M>`endif</span>
            <a  onClick="return qs(event,this,56)"  class=SIT href="top.v.html#273">j</a>=<a  onClick="return qs(event,this,56)"  class=SIT href="top.v.html#297">j</a>+1;
        <span class=K>end</span>
<span class=M>`endif</span>
        <span class=ST>$write</span>(<span class=S>&quot;Running %s\n&quot;</span>, {<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#35">HEX_DIR</a>,<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#38">HEXFILE</a>});
        <span class=ST>$readmemh</span>({<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#35">HEX_DIR</a>,<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#38">HEXFILE</a>}, <a  onClick="return qs(event,this,57)"  class=SR href="top.v.html#275">mem_bbl</a>);
        <a  onClick="return qs(event,this,56)"  class=SIT href="top.v.html#273">j</a>=0;

        <span class=C>/*for(i=0;i&lt;`BBL_SIZE;i=i+4) begin
            mmu.idbmem.idbmem.mem1.mem[j]=mem_bbl[i];
            mmu.idbmem.idbmem.mem2.mem[j]=mem_bbl[i+1];
            mmu.idbmem.idbmem.mem3.mem[j]=mem_bbl[i+2];
            mmu.idbmem.idbmem.mem4.mem[j]=mem_bbl[i+3];
            j=j+1;
        end*/</span>
        <span class=K>for</span>(<a  onClick="return qs(event,this,55)"  class=SIT href="top.v.html#273">i</a>=0;<a  onClick="return qs(event,this,55)"  class=SIT href="top.v.html#273">i</a>&lt;<span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#206">BBL_SIZE</a>;<a  onClick="return qs(event,this,55)"  class=SIT href="top.v.html#273">i</a>=<a  onClick="return qs(event,this,55)"  class=SIT href="top.v.html#273">i</a>+1) <span class=K>begin</span>
<span class=P>`ifdef SKIP_CACHE
</span><span class=P>            mmu.idbmem.idbmem.mem[j]=mem_bbl[i];
</span><span class=M>`else</span>
	    mmu.idbmem.cache_ctrl.idbmem.mem[<a  onClick="return qs(event,this,56)"  class=SIT href="top.v.html#297">j</a>]=<a  onClick="return qs(event,this,57)"  class=SR href="top.v.html#275">mem_bbl</a>[<a  onClick="return qs(event,this,55)"  class=SIT href="top.v.html#273">i</a>];
<span class=M>`endif</span>
            <a  onClick="return qs(event,this,56)"  class=SIT href="top.v.html#273">j</a>=<a  onClick="return qs(event,this,56)"  class=SIT href="top.v.html#297">j</a>+1;
        <span class=K>end</span>
        <span class=ST>$write</span>(<span class=S>&quot;-------------------------------------------------------------------\n&quot;</span>);
    <span class=K>end</span>

<span class=C>/**********************************************************************************************/</span>

<span class=P>`ifdef RAM_DEBUG
</span><span class=P>reg [31:0] o_pc=-1, o_ir=-1, bbl_cnt=0;
</span><span class=P>always @(posedge CLK)
</span><span class=P>begin
</span><span class=P>	if(	(p.r_cpc[31:30] == 3) &amp;&amp; (((mmu.idbmem.r_ctrl==1) &amp;&amp; (mmu.idbmem.r_mask==8)) || 
</span><span class=P>			(mmu.idbmem.r_ctrl==3 &amp;&amp; (mmu.idbmem.r_mask!=15)))
</span><span class=P>	       		&amp;&amp;
</span><span class=P>		((o_pc != p.r_cpc) || (o_ir != p.r_ir)) &amp;&amp; (bbl_cnt &lt; 20)) begin
</span><span class=P>		o_pc &lt;= p.r_cpc;
</span><span class=P>		o_ir &lt;= p.r_ir;
</span><span class=P>		bbl_cnt &lt;= bbl_cnt + 1;
</span><span class=P>		$write(</span><span class=P>&quot;%08d pc=%08x ir=%08x r_addr=%08x %19x odata=%x ctrl=%x mask=%x\n&quot;</span><span class=P>,
</span><span class=P>                	p.mtime[31:0], p.r_cpc, p.r_ir,
</span><span class=P>	                mmu.idbmem.r_addr, 
</span><span class=P>			mmu.idbmem.w_odata_aux, mmu.idbmem.w_odata, 
</span><span class=P>			mmu.idbmem.r_ctrl, mmu.idbmem.r_mask);
</span><span class=P>	end
</span><span class=P>end
</span><span class=M>`endif</span>

<span class=C>//`define DEBUG_MEMMOVE
</span><span class=P>`ifdef DEBUG_MEMMOVE
</span><span class=P>//`define ADDR_MEMMOVE_START 32'h80002942
</span><span class=P>`define ADDR_MEMMOVE_START 32'hc02b3330
</span><span class=P>//`define ADDR_WORD_COPY 32'h8000296a
</span><span class=P>`define ADDR_WORD_COPY 32'hc02b334e
</span><span class=P>//`define ADDR_MEMMOVE_STOP 32'h800029e2
</span><span class=P>`define ADDR_MEMMOVE_STOP 32'hc02b339c
</span><span class=P>//`define TEXT_ADDR 32'h8000bd84
</span><span class=P>`define TEXT_ADDR 32'hc0c000d0
</span><span class=P>`define STRLEN_TEXT 170
</span>
<span class=P>//`define ADDR_MEMMOVE_START 32'h80002934
</span><span class=P>//`define ADDR_WORD_COPY 32'h8000295c
</span><span class=P>//`define ADDR_MEMMOVE_STOP 32'h800029d4
</span><span class=P>//`define TEXT_ADDR 32'h8000bdf8
</span><span class=P>//`define STRLEN_TEXT 53
</span><span class=P>reg [31:0] old_pc=0, t3;
</span><span class=P>reg [7:0] a0,a1,a2,a3;
</span><span class=P>always @(posedge CLK)
</span><span class=P>begin
</span><span class=P>    if((p.r_cpc &gt;= `ADDR_MEMMOVE_START) &amp;&amp; (p.r_cpc &lt;= `ADDR_MEMMOVE_STOP) &amp;&amp; 
</span><span class=P>	    ((old_pc != p.r_cpc) || (p.regs.mem[28] != t3))) begin
</span><span class=P>        old_pc &lt;= p.r_cpc;
</span><span class=P>	t3 &lt;= p.regs.mem[28];
</span><span class=P>        $write(</span><span class=P>&quot;%08d %08x %08x mem addr: %08x %08x %16x %1x %8x\n&quot;</span><span class=P>, 
</span><span class=P>		p.mtime[31:0], p.r_cpc, p.r_ir, 
</span><span class=P>		mmu.idbmem.idbmem.w_addr, mmu.idbmem.r_addr,
</span><span class=P>		mmu.idbmem.r_odata, mmu.idbmem.r_addr[3:0], mmu.idbmem.w_odata_t);
</span>        <span class=P>// REGSTATE
</span><span class=P>        for(i=0;i&lt;32;i=i+1)
</span><span class=P>	    if((p.regs.mem[i] != 32'd0) || (i == 7))
</span><span class=P>	    if((i &gt;= 5) &amp;&amp; (i &lt;= 7))
</span><span class=P>		$write(</span><span class=P>&quot;t%1d=%x &quot;</span><span class=P>, i-5, p.regs.mem[i]);
</span><span class=P>	    else if((i &gt;= 28)) begin
</span><span class=P>  	        if((i == 28) &amp;&amp; (p.r_cpc &gt;= `ADDR_WORD_COPY)) begin </span><span class=P>// 32'h20 = ' '
</span><span class=P>		    $write(</span><span class=P>&quot;t3=%c%c%c%c=%x &quot;</span><span class=P>, 
</span><span class=P>			    (p.regs.mem[i] &gt;&gt; 24) &gt;= 32'h20 ? (p.regs.mem[i] &gt;&gt; 24) : 32'h20, 
</span><span class=P>			    ((p.regs.mem[i] &gt;&gt; 16) &amp; 8'hff) &gt;= 32'h20 ? ((p.regs.mem[i] &gt;&gt; 16) &amp; 8'hff) : 32'h20, 
</span><span class=P>			    ((p.regs.mem[i] &gt;&gt; 8) &amp; 8'hff) &gt;= 32'h20 ? ((p.regs.mem[i] &gt;&gt; 8) &amp; 8'hff) : 32'h20,
</span><span class=P>			    (p.regs.mem[i] &amp; 8'hff) &gt;= 32'h20 ? (p.regs.mem[i] &amp; 8'hff) : 32'h20, 
</span><span class=P>			    p.regs.mem[i]);
</span><span class=P>		end else
</span><span class=P>		    $write(</span><span class=P>&quot;t%1d=%x &quot;</span><span class=P>, i-28+3, p.regs.mem[i]);
</span><span class=P>            end
</span><span class=P>	    else if((i &gt;= 10) &amp;&amp; (i &lt;= 17))
</span><span class=P>                $write(</span><span class=P>&quot;a%1d=%x &quot;</span><span class=P>, i-10, p.regs.mem[i]);
</span><span class=P>	    else
</span><span class=P>		$write(</span><span class=P>&quot;R[%2d]=%x &quot;</span><span class=P>, i, p.regs.mem[i]);
</span><span class=P>        $write(</span><span class=P>&quot;\n&quot;</span><span class=P>);
</span><span class=P>	$write(</span><span class=P>&quot;mem[%x]: &quot;</span><span class=P>, `TEXT_ADDR);
</span><span class=P>        for(i=(`TEXT_ADDR &amp; 32'h3ffffff);i&lt;((`TEXT_ADDR+`STRLEN_TEXT)&amp;32'h3ffffff);i=i+1)
</span><span class=P>            $write(</span><span class=P>&quot;%c&quot;</span><span class=P>, mmu.idbmem.idbmem.mem[i]);</span><span class=P>//, mmu.idbmem.idbmem.mem[i]);
</span><span class=P>        $write(</span><span class=P>&quot;\n&quot;</span><span class=P>);
</span><span class=P>    end
</span><span class=P>end
</span><span class=M>`endif</span> <span class=C>//DEBUG_MEMMOVE
</span><span class=C>/**********************************************************************************************/</span>

<span class=P>`ifdef DEBUG
</span><span class=P>    `ifndef TRACE
</span><span class=P>    integer fp;
</span><span class=P>    initial begin
</span><span class=P>        fp=$fopen(</span><span class=P>&quot;log.txt&quot;</span><span class=P>,</span><span class=P>&quot;w&quot;</span><span class=P>);
</span><span class=P>        if(fp == 0)begin
</span><span class=P>            $display(</span><span class=P>&quot;File Open Error!!!!!&quot;</span><span class=P>);
</span><span class=P>            $finish();
</span><span class=P>        end
</span><span class=P>    end
</span><span class=P>    `else
</span><span class=P>        `ifdef LINUX
</span><span class=P>    integer fp;
</span><span class=P>    initial begin
</span><span class=P>        fp=$fopen(</span><span class=P>&quot;log_00M_10M.txt&quot;</span><span class=P>,</span><span class=P>&quot;w&quot;</span><span class=P>);
</span><span class=P>        if(fp == 0)begin
</span><span class=P>            $display(</span><span class=P>&quot;File Open Error!!!!!&quot;</span><span class=P>);
</span><span class=P>            $finish();
</span><span class=P>        end
</span><span class=P>    end
</span>
<span class=P>    always@(posedge CLK) begin
</span><span class=P>        if(p.state == `S_INI &amp;&amp; !p.w_busy) begin
</span><span class=P>            if(p.mtime == 10000001) begin
</span><span class=P>                $fclose(fp);
</span><span class=P>                fp=$fopen(</span><span class=P>&quot;log_10M_20M.txt&quot;</span><span class=P>,</span><span class=P>&quot;w&quot;</span><span class=P>);
</span><span class=P>            end
</span><span class=P>            else if (p.mtime == 20000001) begin
</span><span class=P>                $fclose(fp);
</span><span class=P>                fp=$fopen(</span><span class=P>&quot;log_20M_30M.txt&quot;</span><span class=P>,</span><span class=P>&quot;w&quot;</span><span class=P>);
</span><span class=P>            end
</span><span class=P>            else if (p.mtime == 30000001) begin
</span><span class=P>                $fclose(fp);
</span><span class=P>                fp=$fopen(</span><span class=P>&quot;log_30M_40M.txt&quot;</span><span class=P>,</span><span class=P>&quot;w&quot;</span><span class=P>);
</span><span class=P>            end
</span><span class=P>            else if (p.mtime == 40000001) begin
</span><span class=P>                $fclose(fp);
</span><span class=P>                fp=$fopen(</span><span class=P>&quot;log_40M_50M.txt&quot;</span><span class=P>,</span><span class=P>&quot;w&quot;</span><span class=P>);
</span><span class=P>            end
</span><span class=P>            else if (p.mtime == 50000001) begin
</span><span class=P>                $fclose(fp);
</span><span class=P>                fp=$fopen(</span><span class=P>&quot;log_50M_60M.txt&quot;</span><span class=P>,</span><span class=P>&quot;w&quot;</span><span class=P>);
</span><span class=P>            end
</span><span class=P>            else if (p.mtime == 60000001) begin
</span><span class=P>                $fclose(fp);
</span><span class=P>                fp=$fopen(</span><span class=P>&quot;log_60M_70M.txt&quot;</span><span class=P>,</span><span class=P>&quot;w&quot;</span><span class=P>);
</span><span class=P>            end
</span><span class=P>            else if (p.mtime == 70000001) begin
</span><span class=P>                $fclose(fp);
</span><span class=P>                fp=$fopen(</span><span class=P>&quot;log_70M_80M.txt&quot;</span><span class=P>,</span><span class=P>&quot;w&quot;</span><span class=P>);
</span><span class=P>            end
</span><span class=P>            else if (p.mtime == 80000001) begin
</span><span class=P>                $fclose(fp);
</span><span class=P>                fp=$fopen(</span><span class=P>&quot;log_80M_90M.txt&quot;</span><span class=P>,</span><span class=P>&quot;w&quot;</span><span class=P>);
</span><span class=P>            end
</span><span class=P>            else if (p.mtime == 90000001) begin
</span><span class=P>                $fclose(fp);
</span><span class=P>            end
</span>
<span class=P>            if(fp == 0)begin
</span><span class=P>                $display(</span><span class=P>&quot;File Open Error!!!!!&quot;</span><span class=P>);
</span><span class=P>                $finish();
</span><span class=P>            end
</span><span class=P>        end
</span><span class=P>    end
</span><span class=P>        `else
</span><span class=P>    integer fp;
</span><span class=P>    initial begin
</span><span class=P>        fp=$fopen(</span><span class=P>&quot;log.txt&quot;</span><span class=P>,</span><span class=P>&quot;w&quot;</span><span class=P>);
</span><span class=P>        if(fp == 0)begin
</span><span class=P>            $display(</span><span class=P>&quot;File Open Error!!!!!&quot;</span><span class=P>);
</span><span class=P>            $finish();
</span><span class=P>        end
</span><span class=P>    end
</span><span class=P>        `endif
</span><span class=P>    `endif
</span><span class=M>`endif</span>

<a name="496"></a>    <span class=K>reg</span> [31:0] <a  onClick="return qs(event,this,60)"  class=SR href="top.v.html#498">r_cnt</a> = 0;
    <span class=K>always</span>@(<span class=K>posedge</span> <a  onClick="return qs(event,this,1)"  href="top.v.html#34">CLK</a>) <span class=K>begin</span>
<a name="498"></a>        <a  onClick="return qs(event,this,60)"  class=SR href="top.v.html#496">r_cnt</a> &lt;= <a  onClick="return qs(event,this,60)"  class=SR href="top.v.html#498">r_cnt</a> + 1;
        <span class=K>if</span>(p.mtime &gt; <span class=D>`</span><a  onClick="return qs(event,this,0)"  class=D href="define.vh.html#30">TIMEOUT</a>) <span class=K>begin</span>
            <span class=ST>$write</span>(<span class=S>&quot;Simulation Time out...\n&quot;</span>);
<span class=P>`ifdef MEM_DUMP
</span><span class=P>            $fclose(fp);
</span><span class=P>            fp=$fopen(</span><span class=P>&quot;final_mem.txt&quot;</span><span class=P>,</span><span class=P>&quot;w&quot;</span><span class=P>);
</span><span class=P>            if(fp == 0)begin
</span><span class=P>                $display(</span><span class=P>&quot;File Open Error!!!!! in final_mem!&quot;</span><span class=P>);
</span><span class=P>                $finish();
</span><span class=P>            end
</span><span class=P>            j=0;
</span><span class=P>            for(i=0;i&lt;`BBL_SIZE;i=i+4) begin
</span><span class=P>                $fwrite(fp,</span><span class=P>&quot;%x\n&quot;</span><span class=P>,mmu.idbmem.mem1.mem[j]);
</span><span class=P>                $fwrite(fp,</span><span class=P>&quot;%x\n&quot;</span><span class=P>,mmu.idbmem.mem2.mem[j]);
</span><span class=P>                $fwrite(fp,</span><span class=P>&quot;%x\n&quot;</span><span class=P>,mmu.idbmem.mem3.mem[j]);
</span><span class=P>                $fwrite(fp,</span><span class=P>&quot;%x\n&quot;</span><span class=P>,mmu.idbmem.mem4.mem[j]);
</span><span class=P>                j=j+1;
</span><span class=P>            end
</span><span class=P>            $fclose(fp);
</span><span class=M>`endif</span>
            <span class=ST>$finish</span>();
        <span class=K>end</span>

<span class=P>`ifdef DEBUG
</span>        <span class=P>// EXEC STATE
</span><span class=P>        if(p.state == `S_FIN &amp;&amp; !p.w_busy) begin
</span><span class=P>            if(p.mtime % 1000000 == 0) begin
</span><span class=P>                $write(</span><span class=P>&quot;MTIME=%09d %d\n&quot;</span><span class=P>, p.mtime[31:0], p.mtimecmp);
</span><span class=P>    `ifndef VERILATOR
</span><span class=P>                $fflush();
</span><span class=P>    `endif
</span><span class=P>            end
</span><span class=P>`ifdef TRACE
</span><span class=P>            $fwrite(fp, </span><span class=P>&quot;%08d %08x %08x\n&quot;</span><span class=P>, p.mtime[31:0], p.r_cpc, p.r_ir);
</span>            <span class=P>// REGSTATE
</span><span class=P>            for(i=0;i&lt;4;i=i+1) begin
</span><span class=P>                for(j=0;j&lt;8;j=j+1) begin
</span><span class=P>                    $fwrite(fp, </span><span class=P>&quot;%08x&quot;</span><span class=P>,p.regs.mem[i*8+j]);
</span><span class=P>                    if(j==7)    $fwrite(fp, </span><span class=P>&quot;\n&quot;</span><span class=P>);
</span><span class=P>                    else        $fwrite(fp, </span><span class=P>&quot; &quot;</span><span class=P>);
</span><span class=P>                end
</span><span class=P>            end
</span><span class=P>`ifdef LINUX
</span>            <span class=P>// CSR STATE
</span><span class=P>    `ifndef VERILATOR
</span><span class=P>            #1
</span><span class=P>    `endif
</span><span class=P>            $fwrite(fp, </span><span class=P>&quot;%08x %08x %08x %08x %08x %08x %08x %08x \n&quot;</span><span class=P>, p.mstatus, p.mtvec, p.mscratch, p.mepc, p.mcause, p.mtval, p.mhartid, p.misa);
</span><span class=P>            $fwrite(fp, </span><span class=P>&quot;%08x %08x %08x %08x %08x %08x %08x %08x \n&quot;</span><span class=P>, p.mie, p.mip, p.medeleg, p.mideleg, p.mcounteren, p.stvec, p.sscratch, p.sepc);
</span><span class=P>            $fwrite(fp, </span><span class=P>&quot;%08x %08x %08x %08x %08x %08x %08x %08x \n&quot;</span><span class=P>, p.scause, p.stval, p.satp, p.scounteren, p.load_res, p.pending_exception, p.pending_tval, {30'h0,p.priv});
</span>            
            <span class=P>//TLB
</span><span class=P>            for(i=0;i&lt;4;i=i+1) begin
</span><span class=P>                $fwrite(fp, </span><span class=P>&quot;%08x %08x &quot;</span><span class=P>, (mmu.TLB_inst_r.r_valid[i]) ? {mmu.TLB_inst_r.mem[i][39:22], i[1:0], 12'b0} : 32'hffffffff, (mmu.TLB_inst_r.r_valid[i]) ? {mmu.TLB_inst_r.mem[i][21:0], 10'b0} : 32'hffffffff);
</span><span class=P>            end
</span><span class=P>            $fwrite(fp,</span><span class=P>&quot;\n&quot;</span><span class=P>);
</span><span class=P>            for(i=0;i&lt;4;i=i+1) begin
</span><span class=P>                $fwrite(fp, </span><span class=P>&quot;%08x %08x &quot;</span><span class=P>, (mmu.TLB_data_r.r_valid[i]) ? {mmu.TLB_data_r.mem[i][39:22], i[1:0], 12'b0} : 32'hffffffff, (mmu.TLB_data_r.r_valid[i]) ? {mmu.TLB_data_r.mem[i][21:0], 10'b0} : 32'hffffffff);
</span><span class=P>            end
</span><span class=P>            $fwrite(fp,</span><span class=P>&quot;\n&quot;</span><span class=P>);
</span><span class=P>            for(i=0;i&lt;4;i=i+1) begin
</span><span class=P>                $fwrite(fp, </span><span class=P>&quot;%08x %08x &quot;</span><span class=P>, (mmu.TLB_data_w.r_valid[i]) ? {mmu.TLB_data_w.mem[i][39:22], i[1:0], 12'b0} : 32'hffffffff, (mmu.TLB_data_w.r_valid[i]) ? {mmu.TLB_data_w.mem[i][21:0], 10'b0} : 32'hffffffff);
</span><span class=P>            end
</span><span class=P>            $fwrite(fp,</span><span class=P>&quot;\n&quot;</span><span class=P>);
</span><span class=P>`endif
</span><span class=P>`endif
</span><span class=P>`ifdef PC_TRACE
</span><span class=P>            if(p.mtime % 1000 == 0) begin
</span><span class=P>                $fwrite(fp, </span><span class=P>&quot;%08d %08x\n&quot;</span><span class=P>, (p.mtime[31:0]/1000), p.r_cpc);
</span><span class=P>    `ifndef VERILATOR
</span><span class=P>                $fflush(fp);
</span><span class=P>    `endif
</span><span class=P>            end
</span><span class=P>`endif
</span>
<span class=P>        end
</span><span class=M>`endif</span>
    <span class=K>end</span>
<span class=P>`ifdef MIDDLE
</span><span class=P>    initial begin
</span><span class=P>        #300
</span><span class=P>        `include `REGFILE
</span><span class=P>    end
</span><span class=P>`endif
</span>
<span class=P>`ifdef STATE
</span><span class=P>    always@(posedge CLK) begin
</span><span class=P>        case(p.state)
</span><span class=P>            `S_INI: $write(</span><span class=P>&quot;state: S_INI&quot;</span><span class=P>);
</span><span class=P>            `S_IF : $write(</span><span class=P>&quot;state: S_IF &quot;</span><span class=P>);
</span><span class=P>            `S_CVT: $write(</span><span class=P>&quot;state: S_CVT&quot;</span><span class=P>);
</span><span class=P>            `S_ID : $write(</span><span class=P>&quot;state: S_ID &quot;</span><span class=P>);
</span><span class=P>            `S_OF : $write(</span><span class=P>&quot;state: S_OF &quot;</span><span class=P>);
</span><span class=P>            `S_EX1: $write(</span><span class=P>&quot;state: S_EX1&quot;</span><span class=P>);
</span><span class=P>            `S_LD : $write(</span><span class=P>&quot;state: S_LD &quot;</span><span class=P>);
</span><span class=P>            `S_EX2: $write(</span><span class=P>&quot;state: S_EX2&quot;</span><span class=P>);
</span><span class=P>            `S_SD : $write(</span><span class=P>&quot;state: S_SD &quot;</span><span class=P>);
</span><span class=P>            `S_WB : $write(</span><span class=P>&quot;state: S_WB &quot;</span><span class=P>);
</span><span class=P>            `S_COM: $write(</span><span class=P>&quot;state: S_COM&quot;</span><span class=P>);
</span><span class=P>            `S_FIN: $write(</span><span class=P>&quot;state: S_FIN&quot;</span><span class=P>);
</span><span class=P>            default: $write(</span><span class=P>&quot;state: UNKNOWN&quot;</span><span class=P>);
</span><span class=P>        endcase
</span><span class=P>        if(p.r_com[2]) $write(</span><span class=P>&quot;  exception&quot;</span><span class=P>);
</span><span class=P>        if(p.r_com[1]) $write(</span><span class=P>&quot;  pagefault&quot;</span><span class=P>);
</span><span class=P>        if(p.r_com[0]) $write(</span><span class=P>&quot;  ecall&quot;</span><span class=P>);
</span><span class=P>        $write(</span><span class=P>&quot;\n&quot;</span><span class=P>);
</span><span class=P>        if(p.state == `S_FIN &amp;&amp; !p.w_busy) begin
</span><span class=P>            $write(</span><span class=P>&quot;%08d %08x %08x\n&quot;</span><span class=P>, p.mtime[31:0], p.r_cpc, p.r_ir);
</span><span class=P>            $write(</span><span class=P>&quot;--------------------------\n&quot;</span><span class=P>);
</span><span class=P>        end
</span><span class=P>    end
</span><span class=P>`endif
</span>
    <span class=P>/**********************************************************************************************/</span>

<span class=P>    wire init_txd, tx_ready;
</span>
<span class=P>    reg [7:0]   uartdata = 0;
</span><span class=P>    reg         uartwe   = 0;
</span><span class=P>    reg [16:0]  imemaddr = 0;
</span>
<span class=P>    always@(posedge CLK) begin
</span><span class=P>        if(r_cnt &gt; 10 &amp;&amp; tx_ready &amp;&amp; !uartwe) begin
</span><span class=P>            uartdata &lt;= mem_bbl[imemaddr];
</span><span class=P>            imemaddr &lt;= imemaddr + 1;
</span><span class=P>            uartwe   &lt;= 1;
</span><span class=P>        end else begin
</span><span class=P>            uartwe   &lt;= 0;
</span><span class=P>            uartdata &lt;= 0;
</span><span class=P>        end
</span><span class=P>    end
</span>
<span class=P>    UartTx UartTx_init(CLK, RST_X, uartdata, uartwe, init_txd, tx_ready);
</span>
<span class=P>    assign w_rxd = init_txd;
</span>
<span class=P>endmodule
</span>
<span class=P>/**************************************************************************************************/</span>
<span class=P>/**** Byte unit BRAM Main Memory module with LATENCY for simulation (1-port)                   ****/</span>
<span class=P>/**************************************************************************************************/</span>
<span class=P>`ifdef DRAM_SIM
</span><span class=P>module m_bu_mem #(parameter MEM_SIZE = `MEM_SIZE)
</span><span class=P>            (CLK, w_addr, w_odata, w_we, w_le, w_wdata, w_ctrl, w_stall, w_mask);
</span><span class=P>    input  wire             CLK;
</span><span class=P>    input  wire [31:0] w_addr;
</span><span class=P>    output wire [127:0] w_odata;
</span><span class=P>    input  wire w_we, w_le;
</span><span class=P>    input  wire [31:0] w_wdata;
</span><span class=P>    input  wire [2:0] w_ctrl;
</span><span class=P>    output wire w_stall;
</span>    <span class=P>// active 0 mask
</span><span class=P>    input wire [3:0] w_mask;
</span>
<span class=P>    reg   [7:0] mem [0:MEM_SIZE-1];
</span>
<span class=P>    reg [7:0] state=0;
</span><span class=P>    reg r_stall=0;
</span><span class=P>    assign w_stall = r_stall;
</span><span class=P>    reg [31:0] r_addr;
</span><span class=P>    reg [31:0] r_wdata;
</span><span class=P>    reg [127:0] r_odata=0, r_odata_aux=0;
</span><span class=P>    reg [3:0] r_mask;
</span><span class=P>    assign w_odata=r_odata;
</span><span class=P>    reg [7:0] r_cnt;
</span><span class=P>    `ifdef RAM_DEBUG
</span><span class=P>    reg r_was_read=0, r_was_write=0;
</span><span class=P>    reg r_last_addr=1;
</span><span class=P>    reg [31:0] rd_cnt=20;
</span><span class=P>    `endif
</span><span class=P>    always @(posedge CLK) begin
</span><span class=P>	case(state)
</span><span class=P>	8'd0: begin </span><span class=P>// idle
</span><span class=P>		if(w_le) begin
</span><span class=P>                        state &lt;= 10;
</span><span class=P>                        r_stall &lt;= 1;
</span><span class=P>                        r_addr &lt;= w_addr;
</span><span class=P>			r_odata_aux &lt;= 
</span><span class=P>			   {mem[w_addr+15], mem[w_addr+14], mem[w_addr+13], mem[w_addr+12],
</span><span class=P>                            mem[w_addr+11], mem[w_addr+10], mem[w_addr+9],  mem[w_addr+8],
</span><span class=P>                            mem[w_addr+7],  mem[w_addr+6],  mem[w_addr+5],  mem[w_addr+4],
</span><span class=P>                            mem[w_addr+3],  mem[w_addr+2],  mem[w_addr+1],  mem[w_addr+0]};
</span><span class=P>                end else if(w_we) begin
</span><span class=P>                        state &lt;= 20;
</span><span class=P>                        r_stall &lt;= 1;
</span><span class=P>                        r_addr &lt;= w_addr;
</span><span class=P>                        r_wdata &lt;= w_wdata;
</span><span class=P>			r_mask &lt;= w_mask;
</span><span class=P>                end
</span><span class=P>	end
</span><span class=P>	8'd10: begin
</span><span class=P>		r_odata &lt;= r_odata_aux;
</span><span class=P>		`ifdef RAM_DEBUG
</span><span class=P>		r_was_read &lt;= 1;
</span><span class=P>                `endif
</span><span class=P>		r_cnt &lt;= 0;
</span><span class=P>		state &lt;= 100;
</span><span class=P>	end
</span><span class=P>	8'd20: begin
</span><span class=P>		if(!r_mask[0]) begin
</span><span class=P>			mem[r_addr] &lt;= r_wdata;
</span><span class=P>		end
</span><span class=P>		if(!r_mask[1]) begin
</span><span class=P>			mem[r_addr+1] &lt;= r_wdata &gt;&gt; 8;
</span><span class=P>		end
</span><span class=P>		if(!r_mask[2]) begin
</span><span class=P>                        mem[r_addr+2] &lt;= r_wdata &gt;&gt; 16;
</span><span class=P>		end
</span><span class=P>		if(!r_mask[3]) begin
</span><span class=P>                        mem[r_addr+3] &lt;= r_wdata &gt;&gt; 24;
</span><span class=P>		end
</span><span class=P>		`ifdef RAM_DEBUG
</span><span class=P>		r_was_write &lt;= 1;
</span><span class=P>		`endif
</span><span class=P>		r_cnt &lt;= 0;
</span><span class=P>		state &lt;= 100;
</span><span class=P>	end
</span><span class=P>	8'd100: begin
</span><span class=P>		if(r_cnt &lt;= `LATENCY)
</span><span class=P>			r_cnt &lt;= r_cnt + 1;
</span><span class=P>		else begin
</span><span class=P>			`ifdef RAM_DEBUG
</span><span class=P>			rd_cnt &lt;= rd_cnt + 1;
</span><span class=P>			if(rd_cnt &lt; 20) begin
</span><span class=P>				if(r_was_read &amp;&amp; (r_last_addr != r_addr))
</span><span class=P>					$display(</span><span class=P>&quot;RAM read: mem[%x] is %x&quot;</span><span class=P>, r_addr, r_odata);
</span><span class=P>				if(r_was_write &amp;&amp; (r_last_addr != r_addr))
</span><span class=P>					$display(</span><span class=P>&quot;RAM write: mem[%x] &lt;= %x&quot;</span><span class=P>, r_addr, {mem[r_addr+3], mem[r_addr+2], mem[r_addr+1], mem[r_addr]});
</span><span class=P>			end
</span><span class=P>			`endif
</span><span class=P>			state &lt;= 110;
</span><span class=P>		end
</span><span class=P>	end
</span><span class=P>	8'd110: begin
</span><span class=P>		`ifdef RAM_DEBUG
</span><span class=P>		r_was_read &lt;= 0;
</span><span class=P>		r_was_write &lt;= 0;
</span><span class=P>		r_last_addr &lt;= r_addr;
</span><span class=P>		`endif
</span><span class=P>		state &lt;= 0;
</span><span class=P>		r_stall &lt;= 0;
</span><span class=P>	end
</span><span class=P>	endcase
</span><span class=P>    end
</span>
<span class=P>endmodule
</span><span class=P>/**************************************************************************************************/</span>
<span class=P>/**** BRAM Wrapper for simulation (1-port)                                                     ****/</span>
<span class=P>/**************************************************************************************************/</span>
<span class=P>// template from memory.v
</span><span class=P>module m_dram_sim#(parameter MEM_SIZE = `MEM_SIZE)(
</span><span class=P>     input wire                         o_clk,
</span><span class=P>     input  wire [31:0]                  i_addr,
</span><span class=P>     output wire [31:0]                  o_data,
</span><span class=P>     input  wire                         i_wr_en,
</span><span class=P>     input  wire                         i_rd_en,
</span><span class=P>     input  wire [31:0]                  i_data,
</span><span class=P>     input  wire [2:0]                   i_ctrl,
</span><span class=P>     output wire                         o_busy,
</span><span class=P>     input wire [31:0]                   w_mtime);
</span>
<span class=P>    reg         r_we    = 0;
</span><span class=P>    reg         r_rd    = 0;
</span><span class=P>    wire 	w_busy;
</span><span class=P>    wire[127:0] w_dram_odata;
</span><span class=P>    reg [3:0] r_mask = 0;
</span><span class=P>    reg   [2:0] r_ctrl  = 0;
</span><span class=P>    reg [31:0] r_odata = 0;
</span><span class=P>    reg [127:0] r_dram_odata1 = 0;
</span><span class=P>    reg [23:0] r_dram_odata2 = 0;
</span><span class=P>    reg [31:0] r_maddr, r_addr;
</span>
    <span class=P>// 16+3 bytes shifted with r_addr[3:0]*8 bits
</span><span class=P>    wire[151:0] w_odata_aux = {r_dram_odata2, r_dram_odata1} &gt;&gt; {r_addr[3:0], 3'b0};
</span><span class=P>    wire[31:0] w_odata = w_odata_aux[31:0];
</span><span class=P>    assign o_data = (r_ctrl[1:0]==0) ? ((r_ctrl[2]) ? {24'h0, w_odata[7:0]} :
</span><span class=P>                                         {{24{w_odata[7]}}, w_odata[7:0]}) :
</span><span class=P>                     (r_ctrl[1:0]==1) ? ((r_ctrl[2]) ? {16'h0, w_odata[15:0]} :
</span><span class=P>                                         {{16{w_odata[15]}}, w_odata[15:0]}) :
</span><span class=P>                     w_odata;
</span><span class=P>    reg [31:0] r_wdata=0, r_wdata_ui=0;
</span>
<span class=P>    reg r_stall = 0;
</span><span class=P>    assign o_busy = (r_stall | w_busy);
</span><span class=P>    reg [7:0] state = 0, state_next = 0;
</span><span class=P>    reg [31:0] r_cnt = 0;
</span><span class=P>    `ifdef RAM_DEBUG
</span><span class=P>    reg r_was_read=0, r_was_write=0;
</span><span class=P>    reg [31:0] rd_cnt=20;
</span><span class=P>    `endif
</span><span class=P>    always@(posedge o_clk) begin
</span><span class=P>        case(state)
</span><span class=P>        8'd0: </span><span class=P>// idle
</span><span class=P>                if(i_rd_en &amp;&amp; !w_busy) begin
</span><span class=P>                        state &lt;= 10;
</span><span class=P>			state_next &lt;= 30;
</span><span class=P>			r_rd &lt;= 1;
</span><span class=P>                        r_stall &lt;= 1;
</span><span class=P>                        r_addr &lt;= i_addr;
</span><span class=P>			r_maddr &lt;= {i_addr[31:4], 4'b0};
</span><span class=P>                        r_ctrl &lt;= i_ctrl;
</span><span class=P>			`ifdef RAM_DEBUG
</span><span class=P>			r_was_read &lt;= 1;
</span><span class=P>			`endif
</span><span class=P>                end else if(i_wr_en &amp;&amp; !w_busy) begin
</span><span class=P>			state &lt;= 20;
</span><span class=P>                        r_stall &lt;= 1;
</span><span class=P>			r_addr &lt;= i_addr;
</span><span class=P>                        r_maddr &lt;= {i_addr[31:2], 2'b0};
</span><span class=P>                        r_wdata_ui &lt;= (i_ctrl[1:0] == 0) ? {24'h0, i_data[7:0]} :
</span><span class=P>                                   (i_ctrl[1:0] == 1) ? {16'h0, i_data[15:0]} : i_data;
</span><span class=P>                        r_ctrl &lt;= i_ctrl;
</span><span class=P>			`ifdef RAM_DEBUG
</span><span class=P>			r_was_write &lt;= 1;
</span><span class=P>			`endif
</span><span class=P>                end
</span><span class=P>	8'd10: begin </span><span class=P>//mem read
</span><span class=P>		if(w_busy) begin
</span><span class=P>			r_rd &lt;= 0;
</span><span class=P>                	state &lt;= 11;
</span><span class=P>		end
</span><span class=P>	end
</span><span class=P>	8'd11: begin
</span><span class=P>		if(!w_busy) begin
</span><span class=P>			r_dram_odata1 &lt;= w_dram_odata;
</span><span class=P>			if(r_addr[3:0] &lt;= 12) </span><span class=P>// one read is enough
</span><span class=P>				state &lt;= 100;
</span><span class=P>			else begin
</span><span class=P>				state &lt;= 12;
</span><span class=P>				r_rd &lt;= 1;
</span>				<span class=P>//r_maddr &lt;= {r_addr[31:4]+28'b1, 4'b0};
</span><span class=P>				r_maddr &lt;= r_maddr + 16;
</span><span class=P>			end
</span><span class=P>		end
</span><span class=P>	end
</span><span class=P>	8'd12: begin 
</span>		<span class=P>// idem state 10
</span><span class=P>		if(w_busy) begin
</span><span class=P>                        r_rd &lt;= 0;
</span><span class=P>                        state &lt;= 13;
</span><span class=P>                end
</span><span class=P>	end
</span><span class=P>	8'd13: begin
</span>		<span class=P>// similar state 11
</span><span class=P>		if(!w_busy) begin
</span>                        <span class=P>//r_dram_odata2 &lt;= w_dram_odata[23:0];
</span><span class=P>			r_dram_odata2 &lt;= w_dram_odata;
</span><span class=P>                        state &lt;= 100;
</span><span class=P>                end
</span><span class=P>	end
</span><span class=P>	8'd100: begin
</span><span class=P>		state &lt;= 0;
</span><span class=P>                r_stall &lt;= 0;
</span><span class=P>		`ifdef RAM_DEBUG
</span><span class=P>		r_was_read &lt;= 0;
</span><span class=P>		r_was_write &lt;= 1;
</span><span class=P>`ifdef SKIP_CACHE
</span><span class=P>		if(r_was_read &amp;&amp; (w_odata != {idbmem.mem[r_addr+3], idbmem.mem[r_addr+2], idbmem.mem[r_addr+1], idbmem.mem[r_addr]}))
</span><span class=P>			$display(</span><span class=P>&quot;MEM BUG: r_addr=%x w_odata=%x != %x&quot;</span><span class=P>, r_addr, w_odata, {idbmem.mem[r_addr+3], idbmem.mem[r_addr+2], idbmem.mem[r_addr+1], idbmem.mem[r_addr]});
</span><span class=P>`else
</span><span class=P>`endif
</span><span class=P>		`endif
</span><span class=P>	end
</span><span class=P>	8'd20: begin </span><span class=P>// mem_write
</span><span class=P>                if(r_ctrl[1:0]==0) begin </span><span class=P>// SB
</span><span class=P>			if(r_addr[1:0] == 0) begin
</span><span class=P>                        	r_mask &lt;= 4'b0001;
</span><span class=P>				r_wdata &lt;= r_wdata_ui;
</span><span class=P>			end else if(r_addr[1:0] == 1) begin
</span><span class=P>				r_mask &lt;= 4'b0010;
</span><span class=P>				r_wdata &lt;= r_wdata_ui &lt;&lt; 8;
</span><span class=P>			end else if(r_addr[1:0] == 2) begin
</span><span class=P>                                r_mask &lt;= 4'b0100;
</span><span class=P>				r_wdata &lt;= r_wdata_ui &lt;&lt; 16;
</span><span class=P>			end else if(r_addr[1:0] == 3) begin
</span><span class=P>                                r_mask &lt;= 4'b1000;
</span><span class=P>				r_wdata &lt;= r_wdata_ui &lt;&lt; 24;
</span><span class=P>			end
</span><span class=P>			r_we &lt;= 1;
</span><span class=P>			state &lt;= 21;
</span><span class=P>			state_next &lt;= 100;
</span><span class=P>                end else if(r_ctrl[1:0]==1) begin </span><span class=P>// SH
</span><span class=P>			if(r_addr[1:0] == 0) begin
</span><span class=P>				r_mask &lt;= 4'b0011;
</span><span class=P>				r_wdata &lt;= r_wdata_ui;
</span><span class=P>				r_we &lt;= 1;
</span><span class=P>				state &lt;= 21;
</span><span class=P>				state_next &lt;= 100;
</span><span class=P>			end else if (r_addr[1:0] == 1) begin
</span><span class=P>				r_mask &lt;= 4'b0110;
</span><span class=P>				r_wdata &lt;= r_wdata_ui &lt;&lt; 8;
</span><span class=P>				r_we &lt;= 1;
</span><span class=P>				state &lt;= 21;
</span><span class=P>				state_next &lt;= 100;
</span><span class=P>			end else if (r_addr[1:0] == 2) begin
</span><span class=P>                                r_mask &lt;= 4'b1100;
</span><span class=P>                                r_we &lt;= 1;
</span><span class=P>                                r_wdata &lt;= r_wdata_ui &lt;&lt; 16;
</span><span class=P>                                state &lt;= 21;
</span><span class=P>                                state_next &lt;= 100;
</span><span class=P>			end else if (r_addr[1:0] == 3) begin
</span>				<span class=P>// write in two cycles.
</span><span class=P>                                r_mask &lt;= 4'b1000;
</span><span class=P>                                r_wdata &lt;= r_wdata_ui &lt;&lt; 24;
</span><span class=P>                                r_we &lt;= 1;
</span><span class=P>                                state &lt;= 21;
</span><span class=P>                                state_next &lt;= 31;
</span><span class=P>			end
</span><span class=P>                end else if(r_ctrl[1:0]==2) begin </span><span class=P>// SW
</span><span class=P>			if(r_addr[1:0] == 0) begin
</span><span class=P>				r_mask &lt;= 4'b1111;
</span><span class=P>				r_wdata &lt;= r_wdata_ui;
</span><span class=P>				r_we &lt;= 1;
</span><span class=P>                                state &lt;= 21;
</span><span class=P>                                state_next &lt;= 100;
</span><span class=P>			end else if(r_addr[1:0] == 1) begin
</span>				<span class=P>// write in two cycles.
</span><span class=P>				r_mask &lt;= 4'b1110;
</span><span class=P>				r_wdata &lt;= r_wdata_ui &lt;&lt; 8;
</span><span class=P>				r_we &lt;= 1;
</span><span class=P>				state &lt;= 21;
</span><span class=P>				state_next &lt;= 40;
</span><span class=P>			end else if(r_addr[1:0] == 2) begin
</span>				<span class=P>// write in two cycles.
</span><span class=P>				r_mask &lt;= 4'b1100;
</span><span class=P>                                r_wdata &lt;= r_wdata_ui &lt;&lt; 16;
</span><span class=P>                                r_we &lt;= 1;
</span><span class=P>                                state &lt;= 21;
</span><span class=P>                                state_next &lt;= 41;
</span><span class=P>			end else if(r_addr[1:0] == 3) begin
</span>				<span class=P>// write in two cycles.
</span><span class=P>				r_mask &lt;= 4'b1000;
</span><span class=P>                                r_wdata &lt;= r_wdata_ui &lt;&lt; 24;
</span><span class=P>                                r_we &lt;= 1;
</span><span class=P>                                state &lt;= 21;
</span><span class=P>                                state_next &lt;= 42;
</span><span class=P>			end
</span><span class=P>                end
</span><span class=P>                state &lt;= 21;
</span><span class=P>		r_we &lt;= 1;
</span><span class=P>	end
</span><span class=P>	8'd21: begin
</span><span class=P>		if(w_busy) begin
</span><span class=P>			r_we &lt;= 0;
</span><span class=P>			state &lt;= 22;
</span><span class=P>		end 
</span><span class=P>	end
</span><span class=P>	8'd22: begin
</span><span class=P>		if(!w_busy) begin
</span><span class=P>			state &lt;= state_next;
</span><span class=P>		end
</span><span class=P>	end
</span><span class=P>        8'd31: begin
</span>                <span class=P>// SH with (r_addr[1:0] == 3) second write
</span><span class=P>                r_mask &lt;= 4'b0001;
</span><span class=P>		r_maddr &lt;= r_maddr + 4;
</span><span class=P>		r_wdata &lt;= r_wdata_ui &gt;&gt; 8;
</span><span class=P>                r_we &lt;= 1;
</span><span class=P>                state &lt;= 21;
</span><span class=P>                state_next &lt;= 100;
</span><span class=P>        end
</span><span class=P>	8'd40: begin
</span>		<span class=P>// SW with (r_addr[1:0] == 1) second write
</span><span class=P>		r_mask &lt;= 4'b0001;
</span><span class=P>		r_maddr &lt;= r_maddr + 4;
</span><span class=P>		r_wdata &lt;= r_wdata_ui &gt;&gt; 24;
</span><span class=P>		r_we &lt;= 1;
</span><span class=P>                state &lt;= 21;
</span><span class=P>                state_next &lt;= 100;
</span><span class=P>	end
</span><span class=P>	8'd41: begin
</span>		<span class=P>// SW with (r_addr[1:0] == 2) second write
</span><span class=P>		r_mask &lt;= 4'b0011;
</span><span class=P>		r_maddr &lt;= r_maddr + 4;
</span><span class=P>                r_wdata &lt;= r_wdata_ui &gt;&gt; 16;
</span><span class=P>                r_we &lt;= 1;
</span><span class=P>                state &lt;= 21;
</span><span class=P>                state_next &lt;= 100;
</span><span class=P>	end
</span><span class=P>        8'd42: begin
</span>                <span class=P>// SW with (r_addr[1:0] == 3) second write
</span><span class=P>		r_mask &lt;= 4'b0111;
</span><span class=P>		r_maddr &lt;= r_maddr + 4;
</span><span class=P>                r_wdata &lt;= r_wdata_ui &gt;&gt; 8;
</span><span class=P>                r_we &lt;= 1;
</span><span class=P>                state &lt;= 21;
</span><span class=P>                state_next &lt;= 100;
</span><span class=P>	end
</span><span class=P>	endcase
</span><span class=P>    end
</span>
<span class=P>`ifdef SKIP_CACHE 
</span><span class=P>    m_bu_mem#(MEM_SIZE) idbmem(.CLK(o_clk), .w_addr(r_maddr), .w_odata(w_dram_odata),
</span><span class=P>                               .w_we(r_we), .w_le(r_rd), .w_wdata(r_wdata), .w_ctrl(r_ctrl), .w_stall(w_busy), .w_mask(~r_mask));
</span><span class=P>`else
</span><span class=P>    cache_ctrl#(MEM_SIZE) cache_ctrl(.o_clk(o_clk), .i_rd_en(r_rd), .i_wr_en(r_we), .i_addr(r_maddr), .i_data(r_wdata), 
</span><span class=P>				     .o_data(w_dram_odata), .o_busy(w_busy), .i_mask(r_mask), .w_mtime(w_mtime));
</span><span class=P>`endif </span><span class=P>// SKIP_CACHE
</span><span class=P>endmodule
</span><span class=P>/**************************************************************************************************/</span>

<span class=P>/**** Memory Controller with Cache                                                             ****/</span>

</pre>
<center><table class=NB cols=3 ><tr><td align="center" width="33%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='top.v.p2.html';"><a target="_top" href="top.v.p2.html">Next</a></td><td align="center" width="33%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';" ><font color="#808080">1</font></td><td align="center" width="33%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='top.v.p2.html';"><a target="_top" href="top.v.p2.html">2</a></td></tr></table></center>
<center><table class=NB cols=7 ><tr><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy.html';"><a target="_top" href="hierarchy.html">Hierarchy</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-f.html';"><a target="_top" href="hierarchy-f.html">Files</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-m.html';"><a target="_top" href="hierarchy-m.html">Modules</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-s.html';"><a target="_top" href="hierarchy-s.html">Signals</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-t.html';"><a target="_top" href="hierarchy-t.html">Tasks</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-fn.html';"><a target="_top" href="hierarchy-fn.html">Functions</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='http://www.burbleland.com/v2html/help_7_30.html?';"><a target="_top" href="http://www.burbleland.com/v2html/help_7_30.html?">Help</a></td></tr></table></center>
<script language="JavaScript"type="text/javascript"><!--
function next_page() { return "top.v.p2.html"; }
function first_page() { return ""; }
var extra_info = [
["S","top.v.html#34","","","top.v.html#34","hierarchy-s.p2.html#CLK___m_topsim"],
["S","top.v.html#34","","","top.v.html#34","hierarchy-s.p7.html#RST_X___m_topsim"],
["S","top.v.html#37","top.v.html#232","","rvcorem.v.html#847","hierarchy-s.p9.html#w_halt___m_topsim"],
["S","top.v.html#39","top.v.html#160","","mmu.v.html#86","hierarchy-s.p9.html#w_finish___m_topsim"],
["S","top.v.html#41","top.v.html#158","","mmu.v.html#366","hierarchy-s.p9.html#w_insn_data___m_topsim"],
["S","top.v.html#41","top.v.html#233","","rvcorem.v.html#202","hierarchy-s.p9.html#w_insn_addr___m_topsim"],
["S","top.v.html#42","top.v.html#159","","mmu.v.html#420","hierarchy-s.p9.html#w_data_data___m_topsim"],
["S","top.v.html#42","top.v.html#237","","rvcorem.v.html#419","hierarchy-s.p9.html#w_data_wdata___m_topsim"],
["S","top.v.html#42","top.v.html#234","","rvcorem.v.html#389","hierarchy-s.p9.html#w_data_addr___m_topsim"],
["S","top.v.html#43","top.v.html#238","","rvcorem.v.html#838","hierarchy-s.p9.html#w_data_we___m_topsim"],
["S","top.v.html#44","top.v.html#239","","rvcorem.v.html#388","hierarchy-s.p9.html#w_data_ctrl___m_topsim"],
["S","top.v.html#46","top.v.html#240","","rvcorem.v.html#839","hierarchy-s.p9.html#w_priv___m_topsim"],
["S","top.v.html#46","top.v.html#241","","rvcorem.v.html#840","hierarchy-s.p9.html#w_satp___m_topsim"],
["S","top.v.html#46","top.v.html#242","","rvcorem.v.html#841","hierarchy-s.p9.html#w_mstatus___m_topsim"],
["S","top.v.html#47","top.v.html#243","","rvcorem.v.html#842","hierarchy-s.p9.html#w_mtime___m_topsim"],
["S","top.v.html#47","top.v.html#244","","rvcorem.v.html#843","hierarchy-s.p9.html#w_mtimecmp___m_topsim"],
["S","top.v.html#47","top.v.html#166","","mmu.v.html#636","hierarchy-s.p9.html#w_wmtimecmp___m_topsim"],
["S","top.v.html#48","top.v.html#167","","mmu.v.html#640","hierarchy-s.p9.html#w_clint_we___m_topsim"],
["S","top.v.html#49","top.v.html#247","","rvcorem.v.html#844","hierarchy-s.p9.html#w_mip___m_topsim"],
["S","top.v.html#49","top.v.html#169","","mmu.v.html#628","hierarchy-s.p9.html#w_wmip___m_topsim"],
["S","top.v.html#50","top.v.html#170","","mmu.v.html#627","hierarchy-s.p9.html#w_plic_we___m_topsim"],
["S","top.v.html#51","top.v.html#171","","mmu.v.html#657","hierarchy-s.p9.html#w_busy___m_topsim"],
["S","top.v.html#52","top.v.html#172","","mmu.v.html#215","hierarchy-s.p9.html#w_pagefault___m_topsim"],
["S","top.v.html#53","top.v.html#252","","rvcorem.v.html#837","hierarchy-s.p9.html#w_tlb_req___m_topsim"],
["S","top.v.html#54","top.v.html#253","","rvcorem.v.html#778","hierarchy-s.p9.html#w_tlb_flush___m_topsim"],
["S","top.v.html#55","top.v.html#175","","mmu.v.html#758","hierarchy-s.p9.html#w_txd___m_topsim"],
["S","top.v.html#56","","","","hierarchy-s.p9.html#w_rxd___m_topsim"],
["S","top.v.html#57","top.v.html#177","","mmu.v.html#800","hierarchy-s.p9.html#w_init_done___m_topsim"],
["S","top.v.html#58","top.v.html#257","","rvcorem.v.html#176","hierarchy-s.p9.html#w_init_stage___m_topsim"],
["S","top.v.html#60","top.v.html#60","","top.v.html#60","hierarchy-s.p2.html#CORE_RST_X___m_topsim"],
["S","top.v.html#63","","","","hierarchy-s.p3.html#ddr2_dq___m_topsim"],
["S","top.v.html#64","","","","hierarchy-s.p3.html#ddr2_dqs_n___m_topsim"],
["S","top.v.html#65","","","","hierarchy-s.p3.html#ddr2_dqs_p___m_topsim"],
["S","top.v.html#66","top.v.html#186","","","hierarchy-s.p3.html#ddr2_addr___m_topsim"],
["S","top.v.html#67","top.v.html#187","","","hierarchy-s.p3.html#ddr2_ba___m_topsim"],
["S","top.v.html#68","top.v.html#188","","","hierarchy-s.p3.html#ddr2_ras_n___m_topsim"],
["S","top.v.html#69","top.v.html#189","","","hierarchy-s.p3.html#ddr2_cas_n___m_topsim"],
["S","top.v.html#70","top.v.html#190","","","hierarchy-s.p3.html#ddr2_we_n___m_topsim"],
["S","top.v.html#71","top.v.html#191","","","hierarchy-s.p3.html#ddr2_ck_p___m_topsim"],
["S","top.v.html#72","top.v.html#192","","","hierarchy-s.p3.html#ddr2_ck_n___m_topsim"],
["S","top.v.html#73","top.v.html#193","","","hierarchy-s.p3.html#ddr2_cke___m_topsim"],
["S","top.v.html#74","top.v.html#194","","","hierarchy-s.p3.html#ddr2_cs_n___m_topsim"],
["S","top.v.html#75","top.v.html#195","","","hierarchy-s.p3.html#ddr2_dm___m_topsim"],
["S","top.v.html#76","top.v.html#196","","","hierarchy-s.p3.html#ddr2_odt___m_topsim"],
["S","top.v.html#96","top.v.html#218","","mmu.v.html#718","hierarchy-s.p9.html#w_uart_data___m_topsim"],
["S","top.v.html#97","top.v.html#219","","mmu.v.html#719","hierarchy-s.p9.html#w_uart_we___m_topsim"],
["S","top.v.html#99","top.v.html#220","","mmu.v.p2.html#1015","hierarchy-s.p9.html#w_led___m_topsim"],
["S","top.v.html#103","","","","hierarchy-s.p7.html#r_uart_busy___m_topsim"],
["S","top.v.html#104","","","","hierarchy-s.p7.html#r_uart_count___m_topsim"],
["S","top.v.html#105","","","","hierarchy-s.p7.html#r_uart_cycle___m_topsim"],
["S","top.v.html#106","","","","hierarchy-s.p7.html#r_uart_data___m_topsim"],
["S","top.v.html#146","top.v.html#224","","mmu.v.html#798","hierarchy-s.p9.html#w_init_state___m_topsim"],
["S","top.v.html#147","top.v.html#225","","loader.v.html#42","hierarchy-s.p9.html#w_pl_init_we___m_topsim"],
["S","top.v.html#262","top.v.html#263","","top.v.html#263","hierarchy-s.p7.html#r_finish___m_topsim"],
["S","top.v.html#273","","","","hierarchy-s.p4.html#i___m_topsim"],
["S","top.v.html#273","top.v.html#297","","top.v.html#297","hierarchy-s.p5.html#j___m_topsim"],
["S","top.v.html#275","","","","hierarchy-s.p5.html#mem_bbl___m_topsim"],
["S","top.v.html#276","","","","hierarchy-s.p5.html#mem_mc___m_topsim"],
["S","top.v.html#277","","","","hierarchy-s.p5.html#mem_disk___m_topsim"],
["S","top.v.html#496","top.v.html#498","","top.v.html#498","hierarchy-s.p7.html#r_cnt___m_topsim"]
];
disabled=0;
// -->
</script>
<hr>
<table>
 <tr><td><i>This page:</i></td>
  <td><i>Created:</i></td><td><i>Fri Feb 11 15:35:04 2022</i></td></tr>
<tr>
 <td> </td>
 <td><i>From:</i></td><td><i>
src/top.v</i></td></tr>
</table>
<hr>
<table width="100%"><tr><td><i>Verilog converted to html by  <a target="_top" href="http://www.burbleland.com/v2html/v2html.html">  v2html 7.30.1.3</a> 
 (written by <a href="mailto:v2html730@burbleland.com">Costas Calamvokis</a>).</i></td><td align="right"><b><a href="http://www.burbleland.com/v2html/help_7_30.html?">Help</a></b></td></tr></table><table height="90%"><tr><td></td></tr></table>
</body>
</html>
